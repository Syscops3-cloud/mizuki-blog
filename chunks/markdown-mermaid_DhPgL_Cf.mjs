import { c as createComponent, m as maybeRenderHead, u as unescapeHTML, d as renderTemplate } from './astro/server_CFIJpBV_.mjs';

const html = () => "<section><h1 id=\"complete-guide-to-markdown-with-mermaid-diagrams\">Complete Guide to Markdown with Mermaid Diagrams<a class=\"anchor\" href=\"#complete-guide-to-markdown-with-mermaid-diagrams\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><p>This article demonstrates how to create various complex diagrams using Mermaid in Markdown documents, including flowcharts, sequence diagrams, Gantt charts, class diagrams, and state diagrams.</p><section><h2 id=\"flowchart-example\">Flowchart Example<a class=\"anchor\" href=\"#flowchart-example\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>Flowcharts are excellent for representing processes or algorithm steps.</p><div class=\"mermaid-diagram-container\"><div class=\"mermaid-wrapper\" id=\"mermaid-cvio9p\"><div class=\"mermaid\" data-mermaid-code=\"graph TD\n    A[Start] --> B{Condition Check}\n    B -->|Yes| C[Process Step 1]\n    B -->|No| D[Process Step 2]\n    C --> E[Subprocess]\n    D --> E\n    subgraph E [Subprocess Details]\n        E1[Substep 1] --> E2[Substep 2]\n        E2 --> E3[Substep 3]\n    end\n    E --> F{Another Decision}\n    F -->|Option 1| G[Result 1]\n    F -->|Option 2| H[Result 2]\n    F -->|Option 3| I[Result 3]\n    G --> J[End]\n    H --> J\n    I --> J\">graph TD\n    A[Start] --> B{Condition Check}\n    B -->|Yes| C[Process Step 1]\n    B -->|No| D[Process Step 2]\n    C --> E[Subprocess]\n    D --> E\n    subgraph E [Subprocess Details]\n        E1[Substep 1] --> E2[Substep 2]\n        E2 --> E3[Substep 3]\n    end\n    E --> F{Another Decision}\n    F -->|Option 1| G[Result 1]\n    F -->|Option 2| H[Result 2]\n    F -->|Option 3| I[Result 3]\n    G --> J[End]\n    H --> J\n    I --> J</div></div><script type=\"text/javascript\">(() => {\n\t// 单例模式：检查是否已经初始化过\n\tif (window.mermaidInitialized) {\n\t\treturn;\n\t}\n\n\twindow.mermaidInitialized = true;\n\n\t// 记录当前主题状态，避免不必要的重新渲染\n\tlet currentTheme = null;\n\tlet isRendering = false; // 防止并发渲染\n\tlet retryCount = 0;\n\tconst MAX_RETRIES = 3;\n\tconst RETRY_DELAY = 1000; // 1秒\n\n\t// 检查主题是否真的发生了变化\n\tfunction hasThemeChanged() {\n\t\tconst isDark = document.documentElement.classList.contains(\"dark\");\n\t\tconst newTheme = isDark ? \"dark\" : \"default\";\n\n\t\tif (currentTheme !== newTheme) {\n\t\t\tcurrentTheme = newTheme;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t// 等待 Mermaid 库加载完成\n\tfunction waitForMermaid(timeout = 10000) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst startTime = Date.now();\n\n\t\t\tfunction check() {\n\t\t\t\tif (window.mermaid && typeof window.mermaid.initialize === \"function\") {\n\t\t\t\t\tresolve(window.mermaid);\n\t\t\t\t} else if (Date.now() - startTime > timeout) {\n\t\t\t\t\treject(new Error(\"Mermaid library failed to load within timeout\"));\n\t\t\t\t} else {\n\t\t\t\t\tsetTimeout(check, 100);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcheck();\n\t\t});\n\t}\n\n\t// 设置 MutationObserver 监听 html 元素的 class 属性变化\n\tfunction setupMutationObserver() {\n\t\tconst observer = new MutationObserver((mutations) => {\n\t\t\tmutations.forEach((mutation) => {\n\t\t\t\tif (\n\t\t\t\t\tmutation.type === \"attributes\" &&\n\t\t\t\t\tmutation.attributeName === \"class\"\n\t\t\t\t) {\n\t\t\t\t\t// 检查是否是 dark 类的变化\n\t\t\t\t\tconst target = mutation.target;\n\t\t\t\t\tconst wasDark = mutation.oldValue\n\t\t\t\t\t\t? mutation.oldValue.includes(\"dark\")\n\t\t\t\t\t\t: false;\n\t\t\t\t\tconst isDark = target.classList.contains(\"dark\");\n\n\t\t\t\t\tif (wasDark !== isDark) {\n\t\t\t\t\t\tif (hasThemeChanged()) {\n\t\t\t\t\t\t\t// 延迟渲染，避免主题切换时的闪烁\n\t\t\t\t\t\t\tsetTimeout(() => renderMermaidDiagrams(), 150);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t// 开始观察 html 元素的 class 属性变化\n\t\tobserver.observe(document.documentElement, {\n\t\t\tattributes: true,\n\t\t\tattributeFilter: [\"class\"],\n\t\t\tattributeOldValue: true,\n\t\t});\n\t}\n\n\t// 缩放平移\n\tfunction attachZoomControls(element, svgElement) {\n\t\tif (element.__zoomAttached) return;\n\t\telement.__zoomAttached = true;\n\n\t\tconst wrapper = document.createElement(\"div\");\n\t\twrapper.className = \"mermaid-zoom-wrapper\";\n\n\t\tconst svgParent = svgElement.parentNode;\n\t\twrapper.appendChild(svgElement);\n\t\tsvgParent.appendChild(wrapper);\n\n\t\tlet scale = 1;\n\t\tlet tx = 0;\n\t\tlet ty = 0;\n\t\tconst MIN_SCALE = 0.2;\n\t\tconst MAX_SCALE = 6;\n\n\t\tfunction applyTransform() {\n\t\t\twrapper.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`;\n\t\t}\n\t\tconst controls = document.createElement(\"div\");\n\t\tcontrols.className = \"mermaid-zoom-controls\";\n\t\tcontrols.innerHTML = `\n\t\t\t<button class=\"btn-regular rounded-lg h-10 w-10 active:scale-90\" data-action=\"zoom-in\" title=\"Zoom in\">+</button>\n\t\t\t<button class=\"btn-regular rounded-lg h-10 w-10 active:scale-90\" data-action=\"zoom-out\" title=\"Zoom out\">−</button>\n\t\t\t<button class=\"btn-regular rounded-lg h-10 w-10 active:scale-90\" data-action=\"reset\" title=\"Reset\">⤾</button>\n\t\t`;\n\t\telement.appendChild(controls);\n\n\t\tcontrols.addEventListener(\"click\", (ev) => {\n\t\t\tconst action =\n\t\t\t\tev.target.getAttribute && ev.target.getAttribute(\"data-action\");\n\t\t\tif (!action) return;\n\n\t\t\tswitch (action) {\n\t\t\t\tcase \"zoom-in\":\n\t\t\t\t\tscale = Math.min(MAX_SCALE, +(scale * 1.2).toFixed(3));\n\t\t\t\t\tapplyTransform();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"zoom-out\":\n\t\t\t\t\tscale = Math.max(MIN_SCALE, +(scale / 1.2).toFixed(3));\n\t\t\t\t\tapplyTransform();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"reset\":\n\t\t\t\t\tscale = 1;\n\t\t\t\t\ttx = 0;\n\t\t\t\t\tty = 0;\n\t\t\t\t\tapplyTransform();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\n\t\tlet isPanning = false;\n\t\tlet startX = 0;\n\t\tlet startY = 0;\n\t\tlet startTx = 0;\n\t\tlet startTy = 0;\n\n\t\twrapper.style.touchAction = \"none\";\n\n\t\twrapper.addEventListener(\"pointerdown\", (ev) => {\n\t\t\tif (ev.button !== 0) return; // 仅左键\n\t\t\tisPanning = true;\n\t\t\twrapper.setPointerCapture(ev.pointerId);\n\t\t\tstartX = ev.clientX;\n\t\t\tstartY = ev.clientY;\n\t\t\tstartTx = tx;\n\t\t\tstartTy = ty;\n\t\t});\n\n\t\twrapper.addEventListener(\"pointermove\", (ev) => {\n\t\t\tif (!isPanning) return;\n\t\t\tconst dx = ev.clientX - startX;\n\t\t\tconst dy = ev.clientY - startY;\n\t\t\ttx = startTx + dx / scale; // 根据当前缩放调整灵敏度\n\t\t\tty = startTy + dy / scale;\n\t\t\tapplyTransform();\n\t\t});\n\n\t\twrapper.addEventListener(\"pointerup\", (ev) => {\n\t\t\tisPanning = false;\n\t\t\ttry {\n\t\t\t\twrapper.releasePointerCapture(ev.pointerId);\n\t\t\t} catch (e) {}\n\t\t});\n\n\t\twrapper.addEventListener(\"pointercancel\", () => {\n\t\t\tisPanning = false;\n\t\t});\n\n\t\t// 鼠标滚轮缩放\n\t\telement.addEventListener(\n\t\t\t\"wheel\",\n\t\t\t(ev) => {\n\t\t\t\tev.preventDefault();\n\t\t\t\tconst delta = -ev.deltaY;\n\t\t\t\tconst zoomFactor = delta > 0 ? 1.12 : 1 / 1.12;\n\t\t\t\tconst prevScale = scale;\n\t\t\t\tscale = Math.min(\n\t\t\t\t\tMAX_SCALE,\n\t\t\t\t\tMath.max(MIN_SCALE, +(scale * zoomFactor).toFixed(3)),\n\t\t\t\t);\n\n\t\t\t\tconst rect = wrapper.getBoundingClientRect();\n\t\t\t\tconst cx = ev.clientX - rect.left;\n\t\t\t\tconst cy = ev.clientY - rect.top;\n\n\t\t\t\tconst worldX = cx / prevScale - tx;\n\t\t\t\tconst worldY = cy / prevScale - ty;\n\n\t\t\t\ttx = cx / scale - worldX;\n\t\t\t\tty = cy / scale - worldY;\n\n\t\t\t\tapplyTransform();\n\t\t\t},\n\t\t\t{ passive: false },\n\t\t);\n\n\t\t// 双击重置\n\t\twrapper.addEventListener(\"dblclick\", () => {\n\t\t\tscale = 1;\n\t\t\ttx = 0;\n\t\t\tty = 0;\n\t\t\tapplyTransform();\n\t\t});\n\t\tapplyTransform();\n\t\tlet resizeTimer = null;\n\t\twindow.addEventListener(\"resize\", () => {\n\t\t\tclearTimeout(resizeTimer);\n\t\t\tresizeTimer = setTimeout(() => {\n\t\t\t\tapplyTransform();\n\t\t\t}, 200);\n\t\t});\n\t}\n\n\t// 设置其他事件监听器\n\tfunction setupEventListeners() {\n\t\t// 监听页面切换\n\t\tdocument.addEventListener(\"astro:page-load\", () => {\n\t\t\t// 重新初始化主题状态\n\t\t\tcurrentTheme = null;\n\t\t\tretryCount = 0; // 重置重试计数\n\t\t\tif (hasThemeChanged()) {\n\t\t\t\tsetTimeout(() => renderMermaidDiagrams(), 100);\n\t\t\t}\n\t\t});\n\n\t\t// 监听页面可见性变化，页面重新可见时重新渲染\n\t\tdocument.addEventListener(\"visibilitychange\", () => {\n\t\t\tif (!document.hidden) {\n\t\t\t\tsetTimeout(() => renderMermaidDiagrams(), 200);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync function initializeMermaid() {\n\t\ttry {\n\t\t\tawait waitForMermaid();\n\n\t\t\t// 初始化 Mermaid 配置\n\t\t\twindow.mermaid.initialize({\n\t\t\t\tstartOnLoad: false,\n\t\t\t\ttheme: \"default\",\n\t\t\t\tthemeVariables: {\n\t\t\t\t\tfontFamily: \"inherit\",\n\t\t\t\t\tfontSize: \"16px\",\n\t\t\t\t},\n\t\t\t\tsecurityLevel: \"loose\",\n\t\t\t\t// 添加错误处理配置\n\t\t\t\terrorLevel: \"warn\",\n\t\t\t\tlogLevel: \"error\",\n\t\t\t});\n\n\t\t\t// 渲染所有 Mermaid 图表\n\t\t\tawait renderMermaidDiagrams();\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Failed to initialize Mermaid:\", error);\n\t\t\t// 如果初始化失败，尝试重新加载\n\t\t\tif (retryCount < MAX_RETRIES) {\n\t\t\t\tretryCount++;\n\t\t\t\tsetTimeout(() => initializeMermaid(), RETRY_DELAY * retryCount);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync function renderMermaidDiagrams() {\n\t\t// 防止并发渲染\n\t\tif (isRendering) {\n\t\t\treturn;\n\t\t}\n\n\t\t// 检查 Mermaid 是否可用\n\t\tif (!window.mermaid || typeof window.mermaid.render !== \"function\") {\n\t\t\tconsole.warn(\"Mermaid not available, skipping render\");\n\t\t\treturn;\n\t\t}\n\n\t\tisRendering = true;\n\n\t\ttry {\n\t\t\tconst mermaidElements = document.querySelectorAll(\n\t\t\t\t\".mermaid[data-mermaid-code]\",\n\t\t\t);\n\n\t\t\tif (mermaidElements.length === 0) {\n\t\t\t\tisRendering = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// 延迟检测主题，确保 DOM 已经更新\n\t\t\tawait new Promise((resolve) => setTimeout(resolve, 100));\n\n\t\t\tconst htmlElement = document.documentElement;\n\t\t\tconst isDark = htmlElement.classList.contains(\"dark\");\n\t\t\tconst theme = isDark ? \"dark\" : \"default\";\n\n\t\t\t// 更新 Mermaid 主题（只需要更新一次）\n\t\t\twindow.mermaid.initialize({\n\t\t\t\tstartOnLoad: false,\n\t\t\t\ttheme: theme,\n\t\t\t\tthemeVariables: {\n\t\t\t\t\tfontFamily: \"inherit\",\n\t\t\t\t\tfontSize: \"16px\",\n\t\t\t\t\t// 强制应用主题变量\n\t\t\t\t\tprimaryColor: isDark ? \"#ffffff\" : \"#000000\",\n\t\t\t\t\tprimaryTextColor: isDark ? \"#ffffff\" : \"#000000\",\n\t\t\t\t\tprimaryBorderColor: isDark ? \"#ffffff\" : \"#000000\",\n\t\t\t\t\tlineColor: isDark ? \"#ffffff\" : \"#000000\",\n\t\t\t\t\tsecondaryColor: isDark ? \"#333333\" : \"#f0f0f0\",\n\t\t\t\t\ttertiaryColor: isDark ? \"#555555\" : \"#e0e0e0\",\n\t\t\t\t},\n\t\t\t\tsecurityLevel: \"loose\",\n\t\t\t\terrorLevel: \"warn\",\n\t\t\t\tlogLevel: \"error\",\n\t\t\t});\n\n\t\t\t// 批量渲染所有图表，添加重试机制\n\t\t\tconst renderPromises = Array.from(mermaidElements).map(\n\t\t\t\tasync (element, index) => {\n\t\t\t\t\tlet attempts = 0;\n\t\t\t\t\tconst maxAttempts = 3;\n\n\t\t\t\t\twhile (attempts < maxAttempts) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst code = element.getAttribute(\"data-mermaid-code\");\n\n\t\t\t\t\t\t\tif (!code) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// 显示加载状态\n\t\t\t\t\t\t\telement.innerHTML =\n\t\t\t\t\t\t\t\t'<div class=\"mermaid-loading\">Rendering diagram...</div>';\n\n\t\t\t\t\t\t\t// 渲染图表\n\t\t\t\t\t\t\tconst { svg } = await window.mermaid.render(\n\t\t\t\t\t\t\t\t`mermaid-${Date.now()}-${index}-${attempts}`,\n\t\t\t\t\t\t\t\tcode,\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tconst parser = new DOMParser();\n\t\t\t\t\t\t\tconst doc = parser.parseFromString(svg, \"image/svg+xml\");\n\t\t\t\t\t\t\tconst svgElement = doc.documentElement;\n\n\t\t\t\t\t\t\telement.innerHTML = \"\";\n\t\t\t\t\t\t\telement.__zoomAttached = false;\n\t\t\t\t\t\t\telement.appendChild(svgElement);\n\n\t\t\t\t\t\t\t// 添加响应式支持\n\t\t\t\t\t\t\tconst insertedSvg = element.querySelector(\"svg\");\n\t\t\t\t\t\t\tif (insertedSvg) {\n\t\t\t\t\t\t\t\tinsertedSvg.setAttribute(\"width\", \"100%\");\n\t\t\t\t\t\t\t\tinsertedSvg.removeAttribute(\"height\");\n\t\t\t\t\t\t\t\tinsertedSvg.style.maxWidth = \"100%\";\n\t\t\t\t\t\t\t\tinsertedSvg.style.height = \"auto\";\n\t\t\t\t\t\t\t\t//Todo 需要根据实际情况\n\t\t\t\t\t\t\t\tinsertedSvg.style.minHeight = \"300px\";\n\n\t\t\t\t\t\t\t\t// 强制应用样式\n\t\t\t\t\t\t\t\tif (isDark) {\n\t\t\t\t\t\t\t\t\tsvgElement.style.filter = \"brightness(0.9) contrast(1.1)\";\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tsvgElement.style.filter = \"none\";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tattachZoomControls(element, insertedSvg);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// 渲染成功，跳出重试循环\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tattempts++;\n\t\t\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\t\t`Mermaid rendering attempt ${attempts} failed for element ${index}:`,\n\t\t\t\t\t\t\t\terror,\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tif (attempts >= maxAttempts) {\n\t\t\t\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t\t\t\t`Failed to render Mermaid diagram after ${maxAttempts} attempts:`,\n\t\t\t\t\t\t\t\t\terror,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\telement.innerHTML = `\n\t\t\t\t\t\t\t\t\t<div class=\"mermaid-error\">\n\t\t\t\t\t\t\t\t\t\t<p>Failed to render diagram after ${maxAttempts} attempts.</p>\n\t\t\t\t\t\t\t\t\t\t<button onclick=\"location.reload()\" style=\"margin-top: 8px; padding: 4px 8px; background: var(--primary); color: white; border: none; border-radius: 4px; cursor: pointer;\">\n\t\t\t\t\t\t\t\t\t\t\tRetry Page\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t`;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// 等待一段时间后重试\n\t\t\t\t\t\t\t\tawait new Promise((resolve) =>\n\t\t\t\t\t\t\t\t\tsetTimeout(resolve, 500 * attempts),\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t);\n\n\t\t\t// 等待所有渲染完成\n\t\t\tawait Promise.all(renderPromises);\n\t\t\tretryCount = 0; // 重置重试计数\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error in renderMermaidDiagrams:\", error);\n\n\t\t\t// 如果渲染失败，尝试重新渲染\n\t\t\tif (retryCount < MAX_RETRIES) {\n\t\t\t\tretryCount++;\n\t\t\t\tsetTimeout(() => renderMermaidDiagrams(), RETRY_DELAY * retryCount);\n\t\t\t}\n\t\t} finally {\n\t\t\tisRendering = false;\n\t\t}\n\t}\n\n\t// 初始化主题状态\n\tfunction initializeThemeState() {\n\t\tconst isDark = document.documentElement.classList.contains(\"dark\");\n\t\tcurrentTheme = isDark ? \"dark\" : \"default\";\n\t}\n\n\t// 加载 Mermaid 库\n\tasync function loadMermaid() {\n\t\tif (typeof window.mermaid !== \"undefined\") {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst script = document.createElement(\"script\");\n\t\t\tscript.src =\n\t\t\t\t\"https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js\";\n\n\t\t\tscript.onload = () => {\n\t\t\t\tconsole.log(\"Mermaid library loaded successfully\");\n\t\t\t\tresolve();\n\t\t\t};\n\n\t\t\tscript.onerror = (error) => {\n\t\t\t\tconsole.error(\"Failed to load Mermaid library:\", error);\n\t\t\t\t// 尝试备用 CDN\n\t\t\t\tconst fallbackScript = document.createElement(\"script\");\n\t\t\t\tfallbackScript.src = \"https://unpkg.com/mermaid@11/dist/mermaid.min.js\";\n\n\t\t\t\tfallbackScript.onload = () => {\n\t\t\t\t\tconsole.log(\"Mermaid library loaded from fallback CDN\");\n\t\t\t\t\tresolve();\n\t\t\t\t};\n\n\t\t\t\tfallbackScript.onerror = () => {\n\t\t\t\t\treject(\n\t\t\t\t\t\tnew Error(\n\t\t\t\t\t\t\t\"Failed to load Mermaid from both primary and fallback CDNs\",\n\t\t\t\t\t\t),\n\t\t\t\t\t);\n\t\t\t\t};\n\n\t\t\t\tdocument.head.appendChild(fallbackScript);\n\t\t\t};\n\n\t\t\tdocument.head.appendChild(script);\n\t\t});\n\t}\n\n\t// 主初始化函数\n\tasync function initialize() {\n\t\ttry {\n\t\t\t// 设置监听器\n\t\t\tsetupMutationObserver();\n\t\t\tsetupEventListeners();\n\n\t\t\t// 初始化主题状态\n\t\t\tinitializeThemeState();\n\n\t\t\t// 加载并初始化 Mermaid\n\t\t\tawait loadMermaid();\n\t\t\tawait initializeMermaid();\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Failed to initialize Mermaid system:\", error);\n\t\t}\n\t}\n\n\t// 启动初始化\n\tif (document.readyState === \"loading\") {\n\t\tdocument.addEventListener(\"DOMContentLoaded\", initialize);\n\t} else {\n\t\tinitialize();\n\t}\n})();\n</script></div></section><section><h2 id=\"sequence-diagram-example\">Sequence Diagram Example<a class=\"anchor\" href=\"#sequence-diagram-example\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>Sequence diagrams show interactions between objects over time.</p><div class=\"mermaid-diagram-container\"><div class=\"mermaid-wrapper\" id=\"mermaid-elom7n\"><div class=\"mermaid\" data-mermaid-code=\"sequenceDiagram\n    participant User\n    participant WebApp\n    participant Server\n    participant Database\n\n    User->>WebApp: Submit Login Request\n    WebApp->>Server: Send Auth Request\n    Server->>Database: Query User Credentials\n    Database-->>Server: Return User Data\n    Server-->>WebApp: Return Auth Result\n    \n    alt Auth Successful\n        WebApp->>User: Show Welcome Page\n        WebApp->>Server: Request User Data\n        Server->>Database: Get User Preferences\n        Database-->>Server: Return Preferences\n        Server-->>WebApp: Return User Data\n        WebApp->>User: Load Personalized Interface\n    else Auth Failed\n        WebApp->>User: Show Error Message\n        WebApp->>User: Prompt Re-entry\n    end\">sequenceDiagram\n    participant User\n    participant WebApp\n    participant Server\n    participant Database\n\n    User->>WebApp: Submit Login Request\n    WebApp->>Server: Send Auth Request\n    Server->>Database: Query User Credentials\n    Database-->>Server: Return User Data\n    Server-->>WebApp: Return Auth Result\n    \n    alt Auth Successful\n        WebApp->>User: Show Welcome Page\n        WebApp->>Server: Request User Data\n        Server->>Database: Get User Preferences\n        Database-->>Server: Return Preferences\n        Server-->>WebApp: Return User Data\n        WebApp->>User: Load Personalized Interface\n    else Auth Failed\n        WebApp->>User: Show Error Message\n        WebApp->>User: Prompt Re-entry\n    end</div></div><script type=\"text/javascript\">(() => {\n\t// 单例模式：检查是否已经初始化过\n\tif (window.mermaidInitialized) {\n\t\treturn;\n\t}\n\n\twindow.mermaidInitialized = true;\n\n\t// 记录当前主题状态，避免不必要的重新渲染\n\tlet currentTheme = null;\n\tlet isRendering = false; // 防止并发渲染\n\tlet retryCount = 0;\n\tconst MAX_RETRIES = 3;\n\tconst RETRY_DELAY = 1000; // 1秒\n\n\t// 检查主题是否真的发生了变化\n\tfunction hasThemeChanged() {\n\t\tconst isDark = document.documentElement.classList.contains(\"dark\");\n\t\tconst newTheme = isDark ? \"dark\" : \"default\";\n\n\t\tif (currentTheme !== newTheme) {\n\t\t\tcurrentTheme = newTheme;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t// 等待 Mermaid 库加载完成\n\tfunction waitForMermaid(timeout = 10000) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst startTime = Date.now();\n\n\t\t\tfunction check() {\n\t\t\t\tif (window.mermaid && typeof window.mermaid.initialize === \"function\") {\n\t\t\t\t\tresolve(window.mermaid);\n\t\t\t\t} else if (Date.now() - startTime > timeout) {\n\t\t\t\t\treject(new Error(\"Mermaid library failed to load within timeout\"));\n\t\t\t\t} else {\n\t\t\t\t\tsetTimeout(check, 100);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcheck();\n\t\t});\n\t}\n\n\t// 设置 MutationObserver 监听 html 元素的 class 属性变化\n\tfunction setupMutationObserver() {\n\t\tconst observer = new MutationObserver((mutations) => {\n\t\t\tmutations.forEach((mutation) => {\n\t\t\t\tif (\n\t\t\t\t\tmutation.type === \"attributes\" &&\n\t\t\t\t\tmutation.attributeName === \"class\"\n\t\t\t\t) {\n\t\t\t\t\t// 检查是否是 dark 类的变化\n\t\t\t\t\tconst target = mutation.target;\n\t\t\t\t\tconst wasDark = mutation.oldValue\n\t\t\t\t\t\t? mutation.oldValue.includes(\"dark\")\n\t\t\t\t\t\t: false;\n\t\t\t\t\tconst isDark = target.classList.contains(\"dark\");\n\n\t\t\t\t\tif (wasDark !== isDark) {\n\t\t\t\t\t\tif (hasThemeChanged()) {\n\t\t\t\t\t\t\t// 延迟渲染，避免主题切换时的闪烁\n\t\t\t\t\t\t\tsetTimeout(() => renderMermaidDiagrams(), 150);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t// 开始观察 html 元素的 class 属性变化\n\t\tobserver.observe(document.documentElement, {\n\t\t\tattributes: true,\n\t\t\tattributeFilter: [\"class\"],\n\t\t\tattributeOldValue: true,\n\t\t});\n\t}\n\n\t// 缩放平移\n\tfunction attachZoomControls(element, svgElement) {\n\t\tif (element.__zoomAttached) return;\n\t\telement.__zoomAttached = true;\n\n\t\tconst wrapper = document.createElement(\"div\");\n\t\twrapper.className = \"mermaid-zoom-wrapper\";\n\n\t\tconst svgParent = svgElement.parentNode;\n\t\twrapper.appendChild(svgElement);\n\t\tsvgParent.appendChild(wrapper);\n\n\t\tlet scale = 1;\n\t\tlet tx = 0;\n\t\tlet ty = 0;\n\t\tconst MIN_SCALE = 0.2;\n\t\tconst MAX_SCALE = 6;\n\n\t\tfunction applyTransform() {\n\t\t\twrapper.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`;\n\t\t}\n\t\tconst controls = document.createElement(\"div\");\n\t\tcontrols.className = \"mermaid-zoom-controls\";\n\t\tcontrols.innerHTML = `\n\t\t\t<button class=\"btn-regular rounded-lg h-10 w-10 active:scale-90\" data-action=\"zoom-in\" title=\"Zoom in\">+</button>\n\t\t\t<button class=\"btn-regular rounded-lg h-10 w-10 active:scale-90\" data-action=\"zoom-out\" title=\"Zoom out\">−</button>\n\t\t\t<button class=\"btn-regular rounded-lg h-10 w-10 active:scale-90\" data-action=\"reset\" title=\"Reset\">⤾</button>\n\t\t`;\n\t\telement.appendChild(controls);\n\n\t\tcontrols.addEventListener(\"click\", (ev) => {\n\t\t\tconst action =\n\t\t\t\tev.target.getAttribute && ev.target.getAttribute(\"data-action\");\n\t\t\tif (!action) return;\n\n\t\t\tswitch (action) {\n\t\t\t\tcase \"zoom-in\":\n\t\t\t\t\tscale = Math.min(MAX_SCALE, +(scale * 1.2).toFixed(3));\n\t\t\t\t\tapplyTransform();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"zoom-out\":\n\t\t\t\t\tscale = Math.max(MIN_SCALE, +(scale / 1.2).toFixed(3));\n\t\t\t\t\tapplyTransform();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"reset\":\n\t\t\t\t\tscale = 1;\n\t\t\t\t\ttx = 0;\n\t\t\t\t\tty = 0;\n\t\t\t\t\tapplyTransform();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\n\t\tlet isPanning = false;\n\t\tlet startX = 0;\n\t\tlet startY = 0;\n\t\tlet startTx = 0;\n\t\tlet startTy = 0;\n\n\t\twrapper.style.touchAction = \"none\";\n\n\t\twrapper.addEventListener(\"pointerdown\", (ev) => {\n\t\t\tif (ev.button !== 0) return; // 仅左键\n\t\t\tisPanning = true;\n\t\t\twrapper.setPointerCapture(ev.pointerId);\n\t\t\tstartX = ev.clientX;\n\t\t\tstartY = ev.clientY;\n\t\t\tstartTx = tx;\n\t\t\tstartTy = ty;\n\t\t});\n\n\t\twrapper.addEventListener(\"pointermove\", (ev) => {\n\t\t\tif (!isPanning) return;\n\t\t\tconst dx = ev.clientX - startX;\n\t\t\tconst dy = ev.clientY - startY;\n\t\t\ttx = startTx + dx / scale; // 根据当前缩放调整灵敏度\n\t\t\tty = startTy + dy / scale;\n\t\t\tapplyTransform();\n\t\t});\n\n\t\twrapper.addEventListener(\"pointerup\", (ev) => {\n\t\t\tisPanning = false;\n\t\t\ttry {\n\t\t\t\twrapper.releasePointerCapture(ev.pointerId);\n\t\t\t} catch (e) {}\n\t\t});\n\n\t\twrapper.addEventListener(\"pointercancel\", () => {\n\t\t\tisPanning = false;\n\t\t});\n\n\t\t// 鼠标滚轮缩放\n\t\telement.addEventListener(\n\t\t\t\"wheel\",\n\t\t\t(ev) => {\n\t\t\t\tev.preventDefault();\n\t\t\t\tconst delta = -ev.deltaY;\n\t\t\t\tconst zoomFactor = delta > 0 ? 1.12 : 1 / 1.12;\n\t\t\t\tconst prevScale = scale;\n\t\t\t\tscale = Math.min(\n\t\t\t\t\tMAX_SCALE,\n\t\t\t\t\tMath.max(MIN_SCALE, +(scale * zoomFactor).toFixed(3)),\n\t\t\t\t);\n\n\t\t\t\tconst rect = wrapper.getBoundingClientRect();\n\t\t\t\tconst cx = ev.clientX - rect.left;\n\t\t\t\tconst cy = ev.clientY - rect.top;\n\n\t\t\t\tconst worldX = cx / prevScale - tx;\n\t\t\t\tconst worldY = cy / prevScale - ty;\n\n\t\t\t\ttx = cx / scale - worldX;\n\t\t\t\tty = cy / scale - worldY;\n\n\t\t\t\tapplyTransform();\n\t\t\t},\n\t\t\t{ passive: false },\n\t\t);\n\n\t\t// 双击重置\n\t\twrapper.addEventListener(\"dblclick\", () => {\n\t\t\tscale = 1;\n\t\t\ttx = 0;\n\t\t\tty = 0;\n\t\t\tapplyTransform();\n\t\t});\n\t\tapplyTransform();\n\t\tlet resizeTimer = null;\n\t\twindow.addEventListener(\"resize\", () => {\n\t\t\tclearTimeout(resizeTimer);\n\t\t\tresizeTimer = setTimeout(() => {\n\t\t\t\tapplyTransform();\n\t\t\t}, 200);\n\t\t});\n\t}\n\n\t// 设置其他事件监听器\n\tfunction setupEventListeners() {\n\t\t// 监听页面切换\n\t\tdocument.addEventListener(\"astro:page-load\", () => {\n\t\t\t// 重新初始化主题状态\n\t\t\tcurrentTheme = null;\n\t\t\tretryCount = 0; // 重置重试计数\n\t\t\tif (hasThemeChanged()) {\n\t\t\t\tsetTimeout(() => renderMermaidDiagrams(), 100);\n\t\t\t}\n\t\t});\n\n\t\t// 监听页面可见性变化，页面重新可见时重新渲染\n\t\tdocument.addEventListener(\"visibilitychange\", () => {\n\t\t\tif (!document.hidden) {\n\t\t\t\tsetTimeout(() => renderMermaidDiagrams(), 200);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync function initializeMermaid() {\n\t\ttry {\n\t\t\tawait waitForMermaid();\n\n\t\t\t// 初始化 Mermaid 配置\n\t\t\twindow.mermaid.initialize({\n\t\t\t\tstartOnLoad: false,\n\t\t\t\ttheme: \"default\",\n\t\t\t\tthemeVariables: {\n\t\t\t\t\tfontFamily: \"inherit\",\n\t\t\t\t\tfontSize: \"16px\",\n\t\t\t\t},\n\t\t\t\tsecurityLevel: \"loose\",\n\t\t\t\t// 添加错误处理配置\n\t\t\t\terrorLevel: \"warn\",\n\t\t\t\tlogLevel: \"error\",\n\t\t\t});\n\n\t\t\t// 渲染所有 Mermaid 图表\n\t\t\tawait renderMermaidDiagrams();\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Failed to initialize Mermaid:\", error);\n\t\t\t// 如果初始化失败，尝试重新加载\n\t\t\tif (retryCount < MAX_RETRIES) {\n\t\t\t\tretryCount++;\n\t\t\t\tsetTimeout(() => initializeMermaid(), RETRY_DELAY * retryCount);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync function renderMermaidDiagrams() {\n\t\t// 防止并发渲染\n\t\tif (isRendering) {\n\t\t\treturn;\n\t\t}\n\n\t\t// 检查 Mermaid 是否可用\n\t\tif (!window.mermaid || typeof window.mermaid.render !== \"function\") {\n\t\t\tconsole.warn(\"Mermaid not available, skipping render\");\n\t\t\treturn;\n\t\t}\n\n\t\tisRendering = true;\n\n\t\ttry {\n\t\t\tconst mermaidElements = document.querySelectorAll(\n\t\t\t\t\".mermaid[data-mermaid-code]\",\n\t\t\t);\n\n\t\t\tif (mermaidElements.length === 0) {\n\t\t\t\tisRendering = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// 延迟检测主题，确保 DOM 已经更新\n\t\t\tawait new Promise((resolve) => setTimeout(resolve, 100));\n\n\t\t\tconst htmlElement = document.documentElement;\n\t\t\tconst isDark = htmlElement.classList.contains(\"dark\");\n\t\t\tconst theme = isDark ? \"dark\" : \"default\";\n\n\t\t\t// 更新 Mermaid 主题（只需要更新一次）\n\t\t\twindow.mermaid.initialize({\n\t\t\t\tstartOnLoad: false,\n\t\t\t\ttheme: theme,\n\t\t\t\tthemeVariables: {\n\t\t\t\t\tfontFamily: \"inherit\",\n\t\t\t\t\tfontSize: \"16px\",\n\t\t\t\t\t// 强制应用主题变量\n\t\t\t\t\tprimaryColor: isDark ? \"#ffffff\" : \"#000000\",\n\t\t\t\t\tprimaryTextColor: isDark ? \"#ffffff\" : \"#000000\",\n\t\t\t\t\tprimaryBorderColor: isDark ? \"#ffffff\" : \"#000000\",\n\t\t\t\t\tlineColor: isDark ? \"#ffffff\" : \"#000000\",\n\t\t\t\t\tsecondaryColor: isDark ? \"#333333\" : \"#f0f0f0\",\n\t\t\t\t\ttertiaryColor: isDark ? \"#555555\" : \"#e0e0e0\",\n\t\t\t\t},\n\t\t\t\tsecurityLevel: \"loose\",\n\t\t\t\terrorLevel: \"warn\",\n\t\t\t\tlogLevel: \"error\",\n\t\t\t});\n\n\t\t\t// 批量渲染所有图表，添加重试机制\n\t\t\tconst renderPromises = Array.from(mermaidElements).map(\n\t\t\t\tasync (element, index) => {\n\t\t\t\t\tlet attempts = 0;\n\t\t\t\t\tconst maxAttempts = 3;\n\n\t\t\t\t\twhile (attempts < maxAttempts) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst code = element.getAttribute(\"data-mermaid-code\");\n\n\t\t\t\t\t\t\tif (!code) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// 显示加载状态\n\t\t\t\t\t\t\telement.innerHTML =\n\t\t\t\t\t\t\t\t'<div class=\"mermaid-loading\">Rendering diagram...</div>';\n\n\t\t\t\t\t\t\t// 渲染图表\n\t\t\t\t\t\t\tconst { svg } = await window.mermaid.render(\n\t\t\t\t\t\t\t\t`mermaid-${Date.now()}-${index}-${attempts}`,\n\t\t\t\t\t\t\t\tcode,\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tconst parser = new DOMParser();\n\t\t\t\t\t\t\tconst doc = parser.parseFromString(svg, \"image/svg+xml\");\n\t\t\t\t\t\t\tconst svgElement = doc.documentElement;\n\n\t\t\t\t\t\t\telement.innerHTML = \"\";\n\t\t\t\t\t\t\telement.__zoomAttached = false;\n\t\t\t\t\t\t\telement.appendChild(svgElement);\n\n\t\t\t\t\t\t\t// 添加响应式支持\n\t\t\t\t\t\t\tconst insertedSvg = element.querySelector(\"svg\");\n\t\t\t\t\t\t\tif (insertedSvg) {\n\t\t\t\t\t\t\t\tinsertedSvg.setAttribute(\"width\", \"100%\");\n\t\t\t\t\t\t\t\tinsertedSvg.removeAttribute(\"height\");\n\t\t\t\t\t\t\t\tinsertedSvg.style.maxWidth = \"100%\";\n\t\t\t\t\t\t\t\tinsertedSvg.style.height = \"auto\";\n\t\t\t\t\t\t\t\t//Todo 需要根据实际情况\n\t\t\t\t\t\t\t\tinsertedSvg.style.minHeight = \"300px\";\n\n\t\t\t\t\t\t\t\t// 强制应用样式\n\t\t\t\t\t\t\t\tif (isDark) {\n\t\t\t\t\t\t\t\t\tsvgElement.style.filter = \"brightness(0.9) contrast(1.1)\";\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tsvgElement.style.filter = \"none\";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tattachZoomControls(element, insertedSvg);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// 渲染成功，跳出重试循环\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tattempts++;\n\t\t\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\t\t`Mermaid rendering attempt ${attempts} failed for element ${index}:`,\n\t\t\t\t\t\t\t\terror,\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tif (attempts >= maxAttempts) {\n\t\t\t\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t\t\t\t`Failed to render Mermaid diagram after ${maxAttempts} attempts:`,\n\t\t\t\t\t\t\t\t\terror,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\telement.innerHTML = `\n\t\t\t\t\t\t\t\t\t<div class=\"mermaid-error\">\n\t\t\t\t\t\t\t\t\t\t<p>Failed to render diagram after ${maxAttempts} attempts.</p>\n\t\t\t\t\t\t\t\t\t\t<button onclick=\"location.reload()\" style=\"margin-top: 8px; padding: 4px 8px; background: var(--primary); color: white; border: none; border-radius: 4px; cursor: pointer;\">\n\t\t\t\t\t\t\t\t\t\t\tRetry Page\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t`;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// 等待一段时间后重试\n\t\t\t\t\t\t\t\tawait new Promise((resolve) =>\n\t\t\t\t\t\t\t\t\tsetTimeout(resolve, 500 * attempts),\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t);\n\n\t\t\t// 等待所有渲染完成\n\t\t\tawait Promise.all(renderPromises);\n\t\t\tretryCount = 0; // 重置重试计数\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error in renderMermaidDiagrams:\", error);\n\n\t\t\t// 如果渲染失败，尝试重新渲染\n\t\t\tif (retryCount < MAX_RETRIES) {\n\t\t\t\tretryCount++;\n\t\t\t\tsetTimeout(() => renderMermaidDiagrams(), RETRY_DELAY * retryCount);\n\t\t\t}\n\t\t} finally {\n\t\t\tisRendering = false;\n\t\t}\n\t}\n\n\t// 初始化主题状态\n\tfunction initializeThemeState() {\n\t\tconst isDark = document.documentElement.classList.contains(\"dark\");\n\t\tcurrentTheme = isDark ? \"dark\" : \"default\";\n\t}\n\n\t// 加载 Mermaid 库\n\tasync function loadMermaid() {\n\t\tif (typeof window.mermaid !== \"undefined\") {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst script = document.createElement(\"script\");\n\t\t\tscript.src =\n\t\t\t\t\"https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js\";\n\n\t\t\tscript.onload = () => {\n\t\t\t\tconsole.log(\"Mermaid library loaded successfully\");\n\t\t\t\tresolve();\n\t\t\t};\n\n\t\t\tscript.onerror = (error) => {\n\t\t\t\tconsole.error(\"Failed to load Mermaid library:\", error);\n\t\t\t\t// 尝试备用 CDN\n\t\t\t\tconst fallbackScript = document.createElement(\"script\");\n\t\t\t\tfallbackScript.src = \"https://unpkg.com/mermaid@11/dist/mermaid.min.js\";\n\n\t\t\t\tfallbackScript.onload = () => {\n\t\t\t\t\tconsole.log(\"Mermaid library loaded from fallback CDN\");\n\t\t\t\t\tresolve();\n\t\t\t\t};\n\n\t\t\t\tfallbackScript.onerror = () => {\n\t\t\t\t\treject(\n\t\t\t\t\t\tnew Error(\n\t\t\t\t\t\t\t\"Failed to load Mermaid from both primary and fallback CDNs\",\n\t\t\t\t\t\t),\n\t\t\t\t\t);\n\t\t\t\t};\n\n\t\t\t\tdocument.head.appendChild(fallbackScript);\n\t\t\t};\n\n\t\t\tdocument.head.appendChild(script);\n\t\t});\n\t}\n\n\t// 主初始化函数\n\tasync function initialize() {\n\t\ttry {\n\t\t\t// 设置监听器\n\t\t\tsetupMutationObserver();\n\t\t\tsetupEventListeners();\n\n\t\t\t// 初始化主题状态\n\t\t\tinitializeThemeState();\n\n\t\t\t// 加载并初始化 Mermaid\n\t\t\tawait loadMermaid();\n\t\t\tawait initializeMermaid();\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Failed to initialize Mermaid system:\", error);\n\t\t}\n\t}\n\n\t// 启动初始化\n\tif (document.readyState === \"loading\") {\n\t\tdocument.addEventListener(\"DOMContentLoaded\", initialize);\n\t} else {\n\t\tinitialize();\n\t}\n})();\n</script></div></section><section><h2 id=\"gantt-chart-example\">Gantt Chart Example<a class=\"anchor\" href=\"#gantt-chart-example\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>Gantt charts are perfect for displaying project schedules and timelines.</p><div class=\"mermaid-diagram-container\"><div class=\"mermaid-wrapper\" id=\"mermaid-lo7nwi\"><div class=\"mermaid\" data-mermaid-code=\"gantt\n    title Website Development Project Timeline\n    dateFormat  YYYY-MM-DD\n    axisFormat  %m/%d\n    \n    section Design Phase\n    Requirements Analysis      :a1, 2023-10-01, 7d\n    UI Design                 :a2, after a1, 10d\n    Prototype Creation        :a3, after a2, 5d\n    \n    section Development Phase\n    Frontend Development      :b1, 2023-10-20, 15d\n    Backend Development       :b2, after a2, 18d\n    Database Design           :b3, after a1, 12d\n    \n    section Testing Phase\n    Unit Testing              :c1, after b1, 8d\n    Integration Testing       :c2, after b2, 10d\n    User Acceptance Testing   :c3, after c2, 7d\n    \n    section Deployment\n    Production Deployment     :d1, after c3, 3d\n    Launch                    :milestone, after d1, 0d\">gantt\n    title Website Development Project Timeline\n    dateFormat  YYYY-MM-DD\n    axisFormat  %m/%d\n    \n    section Design Phase\n    Requirements Analysis      :a1, 2023-10-01, 7d\n    UI Design                 :a2, after a1, 10d\n    Prototype Creation        :a3, after a2, 5d\n    \n    section Development Phase\n    Frontend Development      :b1, 2023-10-20, 15d\n    Backend Development       :b2, after a2, 18d\n    Database Design           :b3, after a1, 12d\n    \n    section Testing Phase\n    Unit Testing              :c1, after b1, 8d\n    Integration Testing       :c2, after b2, 10d\n    User Acceptance Testing   :c3, after c2, 7d\n    \n    section Deployment\n    Production Deployment     :d1, after c3, 3d\n    Launch                    :milestone, after d1, 0d</div></div><script type=\"text/javascript\">(() => {\n\t// 单例模式：检查是否已经初始化过\n\tif (window.mermaidInitialized) {\n\t\treturn;\n\t}\n\n\twindow.mermaidInitialized = true;\n\n\t// 记录当前主题状态，避免不必要的重新渲染\n\tlet currentTheme = null;\n\tlet isRendering = false; // 防止并发渲染\n\tlet retryCount = 0;\n\tconst MAX_RETRIES = 3;\n\tconst RETRY_DELAY = 1000; // 1秒\n\n\t// 检查主题是否真的发生了变化\n\tfunction hasThemeChanged() {\n\t\tconst isDark = document.documentElement.classList.contains(\"dark\");\n\t\tconst newTheme = isDark ? \"dark\" : \"default\";\n\n\t\tif (currentTheme !== newTheme) {\n\t\t\tcurrentTheme = newTheme;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t// 等待 Mermaid 库加载完成\n\tfunction waitForMermaid(timeout = 10000) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst startTime = Date.now();\n\n\t\t\tfunction check() {\n\t\t\t\tif (window.mermaid && typeof window.mermaid.initialize === \"function\") {\n\t\t\t\t\tresolve(window.mermaid);\n\t\t\t\t} else if (Date.now() - startTime > timeout) {\n\t\t\t\t\treject(new Error(\"Mermaid library failed to load within timeout\"));\n\t\t\t\t} else {\n\t\t\t\t\tsetTimeout(check, 100);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcheck();\n\t\t});\n\t}\n\n\t// 设置 MutationObserver 监听 html 元素的 class 属性变化\n\tfunction setupMutationObserver() {\n\t\tconst observer = new MutationObserver((mutations) => {\n\t\t\tmutations.forEach((mutation) => {\n\t\t\t\tif (\n\t\t\t\t\tmutation.type === \"attributes\" &&\n\t\t\t\t\tmutation.attributeName === \"class\"\n\t\t\t\t) {\n\t\t\t\t\t// 检查是否是 dark 类的变化\n\t\t\t\t\tconst target = mutation.target;\n\t\t\t\t\tconst wasDark = mutation.oldValue\n\t\t\t\t\t\t? mutation.oldValue.includes(\"dark\")\n\t\t\t\t\t\t: false;\n\t\t\t\t\tconst isDark = target.classList.contains(\"dark\");\n\n\t\t\t\t\tif (wasDark !== isDark) {\n\t\t\t\t\t\tif (hasThemeChanged()) {\n\t\t\t\t\t\t\t// 延迟渲染，避免主题切换时的闪烁\n\t\t\t\t\t\t\tsetTimeout(() => renderMermaidDiagrams(), 150);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t// 开始观察 html 元素的 class 属性变化\n\t\tobserver.observe(document.documentElement, {\n\t\t\tattributes: true,\n\t\t\tattributeFilter: [\"class\"],\n\t\t\tattributeOldValue: true,\n\t\t});\n\t}\n\n\t// 缩放平移\n\tfunction attachZoomControls(element, svgElement) {\n\t\tif (element.__zoomAttached) return;\n\t\telement.__zoomAttached = true;\n\n\t\tconst wrapper = document.createElement(\"div\");\n\t\twrapper.className = \"mermaid-zoom-wrapper\";\n\n\t\tconst svgParent = svgElement.parentNode;\n\t\twrapper.appendChild(svgElement);\n\t\tsvgParent.appendChild(wrapper);\n\n\t\tlet scale = 1;\n\t\tlet tx = 0;\n\t\tlet ty = 0;\n\t\tconst MIN_SCALE = 0.2;\n\t\tconst MAX_SCALE = 6;\n\n\t\tfunction applyTransform() {\n\t\t\twrapper.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`;\n\t\t}\n\t\tconst controls = document.createElement(\"div\");\n\t\tcontrols.className = \"mermaid-zoom-controls\";\n\t\tcontrols.innerHTML = `\n\t\t\t<button class=\"btn-regular rounded-lg h-10 w-10 active:scale-90\" data-action=\"zoom-in\" title=\"Zoom in\">+</button>\n\t\t\t<button class=\"btn-regular rounded-lg h-10 w-10 active:scale-90\" data-action=\"zoom-out\" title=\"Zoom out\">−</button>\n\t\t\t<button class=\"btn-regular rounded-lg h-10 w-10 active:scale-90\" data-action=\"reset\" title=\"Reset\">⤾</button>\n\t\t`;\n\t\telement.appendChild(controls);\n\n\t\tcontrols.addEventListener(\"click\", (ev) => {\n\t\t\tconst action =\n\t\t\t\tev.target.getAttribute && ev.target.getAttribute(\"data-action\");\n\t\t\tif (!action) return;\n\n\t\t\tswitch (action) {\n\t\t\t\tcase \"zoom-in\":\n\t\t\t\t\tscale = Math.min(MAX_SCALE, +(scale * 1.2).toFixed(3));\n\t\t\t\t\tapplyTransform();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"zoom-out\":\n\t\t\t\t\tscale = Math.max(MIN_SCALE, +(scale / 1.2).toFixed(3));\n\t\t\t\t\tapplyTransform();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"reset\":\n\t\t\t\t\tscale = 1;\n\t\t\t\t\ttx = 0;\n\t\t\t\t\tty = 0;\n\t\t\t\t\tapplyTransform();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\n\t\tlet isPanning = false;\n\t\tlet startX = 0;\n\t\tlet startY = 0;\n\t\tlet startTx = 0;\n\t\tlet startTy = 0;\n\n\t\twrapper.style.touchAction = \"none\";\n\n\t\twrapper.addEventListener(\"pointerdown\", (ev) => {\n\t\t\tif (ev.button !== 0) return; // 仅左键\n\t\t\tisPanning = true;\n\t\t\twrapper.setPointerCapture(ev.pointerId);\n\t\t\tstartX = ev.clientX;\n\t\t\tstartY = ev.clientY;\n\t\t\tstartTx = tx;\n\t\t\tstartTy = ty;\n\t\t});\n\n\t\twrapper.addEventListener(\"pointermove\", (ev) => {\n\t\t\tif (!isPanning) return;\n\t\t\tconst dx = ev.clientX - startX;\n\t\t\tconst dy = ev.clientY - startY;\n\t\t\ttx = startTx + dx / scale; // 根据当前缩放调整灵敏度\n\t\t\tty = startTy + dy / scale;\n\t\t\tapplyTransform();\n\t\t});\n\n\t\twrapper.addEventListener(\"pointerup\", (ev) => {\n\t\t\tisPanning = false;\n\t\t\ttry {\n\t\t\t\twrapper.releasePointerCapture(ev.pointerId);\n\t\t\t} catch (e) {}\n\t\t});\n\n\t\twrapper.addEventListener(\"pointercancel\", () => {\n\t\t\tisPanning = false;\n\t\t});\n\n\t\t// 鼠标滚轮缩放\n\t\telement.addEventListener(\n\t\t\t\"wheel\",\n\t\t\t(ev) => {\n\t\t\t\tev.preventDefault();\n\t\t\t\tconst delta = -ev.deltaY;\n\t\t\t\tconst zoomFactor = delta > 0 ? 1.12 : 1 / 1.12;\n\t\t\t\tconst prevScale = scale;\n\t\t\t\tscale = Math.min(\n\t\t\t\t\tMAX_SCALE,\n\t\t\t\t\tMath.max(MIN_SCALE, +(scale * zoomFactor).toFixed(3)),\n\t\t\t\t);\n\n\t\t\t\tconst rect = wrapper.getBoundingClientRect();\n\t\t\t\tconst cx = ev.clientX - rect.left;\n\t\t\t\tconst cy = ev.clientY - rect.top;\n\n\t\t\t\tconst worldX = cx / prevScale - tx;\n\t\t\t\tconst worldY = cy / prevScale - ty;\n\n\t\t\t\ttx = cx / scale - worldX;\n\t\t\t\tty = cy / scale - worldY;\n\n\t\t\t\tapplyTransform();\n\t\t\t},\n\t\t\t{ passive: false },\n\t\t);\n\n\t\t// 双击重置\n\t\twrapper.addEventListener(\"dblclick\", () => {\n\t\t\tscale = 1;\n\t\t\ttx = 0;\n\t\t\tty = 0;\n\t\t\tapplyTransform();\n\t\t});\n\t\tapplyTransform();\n\t\tlet resizeTimer = null;\n\t\twindow.addEventListener(\"resize\", () => {\n\t\t\tclearTimeout(resizeTimer);\n\t\t\tresizeTimer = setTimeout(() => {\n\t\t\t\tapplyTransform();\n\t\t\t}, 200);\n\t\t});\n\t}\n\n\t// 设置其他事件监听器\n\tfunction setupEventListeners() {\n\t\t// 监听页面切换\n\t\tdocument.addEventListener(\"astro:page-load\", () => {\n\t\t\t// 重新初始化主题状态\n\t\t\tcurrentTheme = null;\n\t\t\tretryCount = 0; // 重置重试计数\n\t\t\tif (hasThemeChanged()) {\n\t\t\t\tsetTimeout(() => renderMermaidDiagrams(), 100);\n\t\t\t}\n\t\t});\n\n\t\t// 监听页面可见性变化，页面重新可见时重新渲染\n\t\tdocument.addEventListener(\"visibilitychange\", () => {\n\t\t\tif (!document.hidden) {\n\t\t\t\tsetTimeout(() => renderMermaidDiagrams(), 200);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync function initializeMermaid() {\n\t\ttry {\n\t\t\tawait waitForMermaid();\n\n\t\t\t// 初始化 Mermaid 配置\n\t\t\twindow.mermaid.initialize({\n\t\t\t\tstartOnLoad: false,\n\t\t\t\ttheme: \"default\",\n\t\t\t\tthemeVariables: {\n\t\t\t\t\tfontFamily: \"inherit\",\n\t\t\t\t\tfontSize: \"16px\",\n\t\t\t\t},\n\t\t\t\tsecurityLevel: \"loose\",\n\t\t\t\t// 添加错误处理配置\n\t\t\t\terrorLevel: \"warn\",\n\t\t\t\tlogLevel: \"error\",\n\t\t\t});\n\n\t\t\t// 渲染所有 Mermaid 图表\n\t\t\tawait renderMermaidDiagrams();\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Failed to initialize Mermaid:\", error);\n\t\t\t// 如果初始化失败，尝试重新加载\n\t\t\tif (retryCount < MAX_RETRIES) {\n\t\t\t\tretryCount++;\n\t\t\t\tsetTimeout(() => initializeMermaid(), RETRY_DELAY * retryCount);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync function renderMermaidDiagrams() {\n\t\t// 防止并发渲染\n\t\tif (isRendering) {\n\t\t\treturn;\n\t\t}\n\n\t\t// 检查 Mermaid 是否可用\n\t\tif (!window.mermaid || typeof window.mermaid.render !== \"function\") {\n\t\t\tconsole.warn(\"Mermaid not available, skipping render\");\n\t\t\treturn;\n\t\t}\n\n\t\tisRendering = true;\n\n\t\ttry {\n\t\t\tconst mermaidElements = document.querySelectorAll(\n\t\t\t\t\".mermaid[data-mermaid-code]\",\n\t\t\t);\n\n\t\t\tif (mermaidElements.length === 0) {\n\t\t\t\tisRendering = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// 延迟检测主题，确保 DOM 已经更新\n\t\t\tawait new Promise((resolve) => setTimeout(resolve, 100));\n\n\t\t\tconst htmlElement = document.documentElement;\n\t\t\tconst isDark = htmlElement.classList.contains(\"dark\");\n\t\t\tconst theme = isDark ? \"dark\" : \"default\";\n\n\t\t\t// 更新 Mermaid 主题（只需要更新一次）\n\t\t\twindow.mermaid.initialize({\n\t\t\t\tstartOnLoad: false,\n\t\t\t\ttheme: theme,\n\t\t\t\tthemeVariables: {\n\t\t\t\t\tfontFamily: \"inherit\",\n\t\t\t\t\tfontSize: \"16px\",\n\t\t\t\t\t// 强制应用主题变量\n\t\t\t\t\tprimaryColor: isDark ? \"#ffffff\" : \"#000000\",\n\t\t\t\t\tprimaryTextColor: isDark ? \"#ffffff\" : \"#000000\",\n\t\t\t\t\tprimaryBorderColor: isDark ? \"#ffffff\" : \"#000000\",\n\t\t\t\t\tlineColor: isDark ? \"#ffffff\" : \"#000000\",\n\t\t\t\t\tsecondaryColor: isDark ? \"#333333\" : \"#f0f0f0\",\n\t\t\t\t\ttertiaryColor: isDark ? \"#555555\" : \"#e0e0e0\",\n\t\t\t\t},\n\t\t\t\tsecurityLevel: \"loose\",\n\t\t\t\terrorLevel: \"warn\",\n\t\t\t\tlogLevel: \"error\",\n\t\t\t});\n\n\t\t\t// 批量渲染所有图表，添加重试机制\n\t\t\tconst renderPromises = Array.from(mermaidElements).map(\n\t\t\t\tasync (element, index) => {\n\t\t\t\t\tlet attempts = 0;\n\t\t\t\t\tconst maxAttempts = 3;\n\n\t\t\t\t\twhile (attempts < maxAttempts) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst code = element.getAttribute(\"data-mermaid-code\");\n\n\t\t\t\t\t\t\tif (!code) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// 显示加载状态\n\t\t\t\t\t\t\telement.innerHTML =\n\t\t\t\t\t\t\t\t'<div class=\"mermaid-loading\">Rendering diagram...</div>';\n\n\t\t\t\t\t\t\t// 渲染图表\n\t\t\t\t\t\t\tconst { svg } = await window.mermaid.render(\n\t\t\t\t\t\t\t\t`mermaid-${Date.now()}-${index}-${attempts}`,\n\t\t\t\t\t\t\t\tcode,\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tconst parser = new DOMParser();\n\t\t\t\t\t\t\tconst doc = parser.parseFromString(svg, \"image/svg+xml\");\n\t\t\t\t\t\t\tconst svgElement = doc.documentElement;\n\n\t\t\t\t\t\t\telement.innerHTML = \"\";\n\t\t\t\t\t\t\telement.__zoomAttached = false;\n\t\t\t\t\t\t\telement.appendChild(svgElement);\n\n\t\t\t\t\t\t\t// 添加响应式支持\n\t\t\t\t\t\t\tconst insertedSvg = element.querySelector(\"svg\");\n\t\t\t\t\t\t\tif (insertedSvg) {\n\t\t\t\t\t\t\t\tinsertedSvg.setAttribute(\"width\", \"100%\");\n\t\t\t\t\t\t\t\tinsertedSvg.removeAttribute(\"height\");\n\t\t\t\t\t\t\t\tinsertedSvg.style.maxWidth = \"100%\";\n\t\t\t\t\t\t\t\tinsertedSvg.style.height = \"auto\";\n\t\t\t\t\t\t\t\t//Todo 需要根据实际情况\n\t\t\t\t\t\t\t\tinsertedSvg.style.minHeight = \"300px\";\n\n\t\t\t\t\t\t\t\t// 强制应用样式\n\t\t\t\t\t\t\t\tif (isDark) {\n\t\t\t\t\t\t\t\t\tsvgElement.style.filter = \"brightness(0.9) contrast(1.1)\";\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tsvgElement.style.filter = \"none\";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tattachZoomControls(element, insertedSvg);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// 渲染成功，跳出重试循环\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tattempts++;\n\t\t\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\t\t`Mermaid rendering attempt ${attempts} failed for element ${index}:`,\n\t\t\t\t\t\t\t\terror,\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tif (attempts >= maxAttempts) {\n\t\t\t\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t\t\t\t`Failed to render Mermaid diagram after ${maxAttempts} attempts:`,\n\t\t\t\t\t\t\t\t\terror,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\telement.innerHTML = `\n\t\t\t\t\t\t\t\t\t<div class=\"mermaid-error\">\n\t\t\t\t\t\t\t\t\t\t<p>Failed to render diagram after ${maxAttempts} attempts.</p>\n\t\t\t\t\t\t\t\t\t\t<button onclick=\"location.reload()\" style=\"margin-top: 8px; padding: 4px 8px; background: var(--primary); color: white; border: none; border-radius: 4px; cursor: pointer;\">\n\t\t\t\t\t\t\t\t\t\t\tRetry Page\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t`;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// 等待一段时间后重试\n\t\t\t\t\t\t\t\tawait new Promise((resolve) =>\n\t\t\t\t\t\t\t\t\tsetTimeout(resolve, 500 * attempts),\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t);\n\n\t\t\t// 等待所有渲染完成\n\t\t\tawait Promise.all(renderPromises);\n\t\t\tretryCount = 0; // 重置重试计数\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error in renderMermaidDiagrams:\", error);\n\n\t\t\t// 如果渲染失败，尝试重新渲染\n\t\t\tif (retryCount < MAX_RETRIES) {\n\t\t\t\tretryCount++;\n\t\t\t\tsetTimeout(() => renderMermaidDiagrams(), RETRY_DELAY * retryCount);\n\t\t\t}\n\t\t} finally {\n\t\t\tisRendering = false;\n\t\t}\n\t}\n\n\t// 初始化主题状态\n\tfunction initializeThemeState() {\n\t\tconst isDark = document.documentElement.classList.contains(\"dark\");\n\t\tcurrentTheme = isDark ? \"dark\" : \"default\";\n\t}\n\n\t// 加载 Mermaid 库\n\tasync function loadMermaid() {\n\t\tif (typeof window.mermaid !== \"undefined\") {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst script = document.createElement(\"script\");\n\t\t\tscript.src =\n\t\t\t\t\"https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js\";\n\n\t\t\tscript.onload = () => {\n\t\t\t\tconsole.log(\"Mermaid library loaded successfully\");\n\t\t\t\tresolve();\n\t\t\t};\n\n\t\t\tscript.onerror = (error) => {\n\t\t\t\tconsole.error(\"Failed to load Mermaid library:\", error);\n\t\t\t\t// 尝试备用 CDN\n\t\t\t\tconst fallbackScript = document.createElement(\"script\");\n\t\t\t\tfallbackScript.src = \"https://unpkg.com/mermaid@11/dist/mermaid.min.js\";\n\n\t\t\t\tfallbackScript.onload = () => {\n\t\t\t\t\tconsole.log(\"Mermaid library loaded from fallback CDN\");\n\t\t\t\t\tresolve();\n\t\t\t\t};\n\n\t\t\t\tfallbackScript.onerror = () => {\n\t\t\t\t\treject(\n\t\t\t\t\t\tnew Error(\n\t\t\t\t\t\t\t\"Failed to load Mermaid from both primary and fallback CDNs\",\n\t\t\t\t\t\t),\n\t\t\t\t\t);\n\t\t\t\t};\n\n\t\t\t\tdocument.head.appendChild(fallbackScript);\n\t\t\t};\n\n\t\t\tdocument.head.appendChild(script);\n\t\t});\n\t}\n\n\t// 主初始化函数\n\tasync function initialize() {\n\t\ttry {\n\t\t\t// 设置监听器\n\t\t\tsetupMutationObserver();\n\t\t\tsetupEventListeners();\n\n\t\t\t// 初始化主题状态\n\t\t\tinitializeThemeState();\n\n\t\t\t// 加载并初始化 Mermaid\n\t\t\tawait loadMermaid();\n\t\t\tawait initializeMermaid();\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Failed to initialize Mermaid system:\", error);\n\t\t}\n\t}\n\n\t// 启动初始化\n\tif (document.readyState === \"loading\") {\n\t\tdocument.addEventListener(\"DOMContentLoaded\", initialize);\n\t} else {\n\t\tinitialize();\n\t}\n})();\n</script></div></section><section><h2 id=\"class-diagram-example\">Class Diagram Example<a class=\"anchor\" href=\"#class-diagram-example\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>Class diagrams show the static structure of a system, including classes, attributes, methods, and their relationships.</p><div class=\"mermaid-diagram-container\"><div class=\"mermaid-wrapper\" id=\"mermaid-4tvc5c\"><div class=\"mermaid\" data-mermaid-code=\"classDiagram\n    class User {\n        +String username\n        +String password\n        +String email\n        +Boolean active\n        +login()\n        +logout()\n        +updateProfile()\n    }\n    \n    class Article {\n        +String title\n        +String content\n        +Date publishDate\n        +Boolean published\n        +publish()\n        +edit()\n        +delete()\n    }\n    \n    class Comment {\n        +String content\n        +Date commentDate\n        +addComment()\n        +deleteComment()\n    }\n    \n    class Category {\n        +String name\n        +String description\n        +addArticle()\n        +removeArticle()\n    }\n    \n    User &#x22;1&#x22; -- &#x22;*&#x22; Article : writes\n    User &#x22;1&#x22; -- &#x22;*&#x22; Comment : posts\n    Article &#x22;1&#x22; -- &#x22;*&#x22; Comment : has\n    Article &#x22;1&#x22; -- &#x22;*&#x22; Category : belongs to\">classDiagram\n    class User {\n        +String username\n        +String password\n        +String email\n        +Boolean active\n        +login()\n        +logout()\n        +updateProfile()\n    }\n    \n    class Article {\n        +String title\n        +String content\n        +Date publishDate\n        +Boolean published\n        +publish()\n        +edit()\n        +delete()\n    }\n    \n    class Comment {\n        +String content\n        +Date commentDate\n        +addComment()\n        +deleteComment()\n    }\n    \n    class Category {\n        +String name\n        +String description\n        +addArticle()\n        +removeArticle()\n    }\n    \n    User \"1\" -- \"*\" Article : writes\n    User \"1\" -- \"*\" Comment : posts\n    Article \"1\" -- \"*\" Comment : has\n    Article \"1\" -- \"*\" Category : belongs to</div></div><script type=\"text/javascript\">(() => {\n\t// 单例模式：检查是否已经初始化过\n\tif (window.mermaidInitialized) {\n\t\treturn;\n\t}\n\n\twindow.mermaidInitialized = true;\n\n\t// 记录当前主题状态，避免不必要的重新渲染\n\tlet currentTheme = null;\n\tlet isRendering = false; // 防止并发渲染\n\tlet retryCount = 0;\n\tconst MAX_RETRIES = 3;\n\tconst RETRY_DELAY = 1000; // 1秒\n\n\t// 检查主题是否真的发生了变化\n\tfunction hasThemeChanged() {\n\t\tconst isDark = document.documentElement.classList.contains(\"dark\");\n\t\tconst newTheme = isDark ? \"dark\" : \"default\";\n\n\t\tif (currentTheme !== newTheme) {\n\t\t\tcurrentTheme = newTheme;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t// 等待 Mermaid 库加载完成\n\tfunction waitForMermaid(timeout = 10000) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst startTime = Date.now();\n\n\t\t\tfunction check() {\n\t\t\t\tif (window.mermaid && typeof window.mermaid.initialize === \"function\") {\n\t\t\t\t\tresolve(window.mermaid);\n\t\t\t\t} else if (Date.now() - startTime > timeout) {\n\t\t\t\t\treject(new Error(\"Mermaid library failed to load within timeout\"));\n\t\t\t\t} else {\n\t\t\t\t\tsetTimeout(check, 100);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcheck();\n\t\t});\n\t}\n\n\t// 设置 MutationObserver 监听 html 元素的 class 属性变化\n\tfunction setupMutationObserver() {\n\t\tconst observer = new MutationObserver((mutations) => {\n\t\t\tmutations.forEach((mutation) => {\n\t\t\t\tif (\n\t\t\t\t\tmutation.type === \"attributes\" &&\n\t\t\t\t\tmutation.attributeName === \"class\"\n\t\t\t\t) {\n\t\t\t\t\t// 检查是否是 dark 类的变化\n\t\t\t\t\tconst target = mutation.target;\n\t\t\t\t\tconst wasDark = mutation.oldValue\n\t\t\t\t\t\t? mutation.oldValue.includes(\"dark\")\n\t\t\t\t\t\t: false;\n\t\t\t\t\tconst isDark = target.classList.contains(\"dark\");\n\n\t\t\t\t\tif (wasDark !== isDark) {\n\t\t\t\t\t\tif (hasThemeChanged()) {\n\t\t\t\t\t\t\t// 延迟渲染，避免主题切换时的闪烁\n\t\t\t\t\t\t\tsetTimeout(() => renderMermaidDiagrams(), 150);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t// 开始观察 html 元素的 class 属性变化\n\t\tobserver.observe(document.documentElement, {\n\t\t\tattributes: true,\n\t\t\tattributeFilter: [\"class\"],\n\t\t\tattributeOldValue: true,\n\t\t});\n\t}\n\n\t// 缩放平移\n\tfunction attachZoomControls(element, svgElement) {\n\t\tif (element.__zoomAttached) return;\n\t\telement.__zoomAttached = true;\n\n\t\tconst wrapper = document.createElement(\"div\");\n\t\twrapper.className = \"mermaid-zoom-wrapper\";\n\n\t\tconst svgParent = svgElement.parentNode;\n\t\twrapper.appendChild(svgElement);\n\t\tsvgParent.appendChild(wrapper);\n\n\t\tlet scale = 1;\n\t\tlet tx = 0;\n\t\tlet ty = 0;\n\t\tconst MIN_SCALE = 0.2;\n\t\tconst MAX_SCALE = 6;\n\n\t\tfunction applyTransform() {\n\t\t\twrapper.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`;\n\t\t}\n\t\tconst controls = document.createElement(\"div\");\n\t\tcontrols.className = \"mermaid-zoom-controls\";\n\t\tcontrols.innerHTML = `\n\t\t\t<button class=\"btn-regular rounded-lg h-10 w-10 active:scale-90\" data-action=\"zoom-in\" title=\"Zoom in\">+</button>\n\t\t\t<button class=\"btn-regular rounded-lg h-10 w-10 active:scale-90\" data-action=\"zoom-out\" title=\"Zoom out\">−</button>\n\t\t\t<button class=\"btn-regular rounded-lg h-10 w-10 active:scale-90\" data-action=\"reset\" title=\"Reset\">⤾</button>\n\t\t`;\n\t\telement.appendChild(controls);\n\n\t\tcontrols.addEventListener(\"click\", (ev) => {\n\t\t\tconst action =\n\t\t\t\tev.target.getAttribute && ev.target.getAttribute(\"data-action\");\n\t\t\tif (!action) return;\n\n\t\t\tswitch (action) {\n\t\t\t\tcase \"zoom-in\":\n\t\t\t\t\tscale = Math.min(MAX_SCALE, +(scale * 1.2).toFixed(3));\n\t\t\t\t\tapplyTransform();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"zoom-out\":\n\t\t\t\t\tscale = Math.max(MIN_SCALE, +(scale / 1.2).toFixed(3));\n\t\t\t\t\tapplyTransform();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"reset\":\n\t\t\t\t\tscale = 1;\n\t\t\t\t\ttx = 0;\n\t\t\t\t\tty = 0;\n\t\t\t\t\tapplyTransform();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\n\t\tlet isPanning = false;\n\t\tlet startX = 0;\n\t\tlet startY = 0;\n\t\tlet startTx = 0;\n\t\tlet startTy = 0;\n\n\t\twrapper.style.touchAction = \"none\";\n\n\t\twrapper.addEventListener(\"pointerdown\", (ev) => {\n\t\t\tif (ev.button !== 0) return; // 仅左键\n\t\t\tisPanning = true;\n\t\t\twrapper.setPointerCapture(ev.pointerId);\n\t\t\tstartX = ev.clientX;\n\t\t\tstartY = ev.clientY;\n\t\t\tstartTx = tx;\n\t\t\tstartTy = ty;\n\t\t});\n\n\t\twrapper.addEventListener(\"pointermove\", (ev) => {\n\t\t\tif (!isPanning) return;\n\t\t\tconst dx = ev.clientX - startX;\n\t\t\tconst dy = ev.clientY - startY;\n\t\t\ttx = startTx + dx / scale; // 根据当前缩放调整灵敏度\n\t\t\tty = startTy + dy / scale;\n\t\t\tapplyTransform();\n\t\t});\n\n\t\twrapper.addEventListener(\"pointerup\", (ev) => {\n\t\t\tisPanning = false;\n\t\t\ttry {\n\t\t\t\twrapper.releasePointerCapture(ev.pointerId);\n\t\t\t} catch (e) {}\n\t\t});\n\n\t\twrapper.addEventListener(\"pointercancel\", () => {\n\t\t\tisPanning = false;\n\t\t});\n\n\t\t// 鼠标滚轮缩放\n\t\telement.addEventListener(\n\t\t\t\"wheel\",\n\t\t\t(ev) => {\n\t\t\t\tev.preventDefault();\n\t\t\t\tconst delta = -ev.deltaY;\n\t\t\t\tconst zoomFactor = delta > 0 ? 1.12 : 1 / 1.12;\n\t\t\t\tconst prevScale = scale;\n\t\t\t\tscale = Math.min(\n\t\t\t\t\tMAX_SCALE,\n\t\t\t\t\tMath.max(MIN_SCALE, +(scale * zoomFactor).toFixed(3)),\n\t\t\t\t);\n\n\t\t\t\tconst rect = wrapper.getBoundingClientRect();\n\t\t\t\tconst cx = ev.clientX - rect.left;\n\t\t\t\tconst cy = ev.clientY - rect.top;\n\n\t\t\t\tconst worldX = cx / prevScale - tx;\n\t\t\t\tconst worldY = cy / prevScale - ty;\n\n\t\t\t\ttx = cx / scale - worldX;\n\t\t\t\tty = cy / scale - worldY;\n\n\t\t\t\tapplyTransform();\n\t\t\t},\n\t\t\t{ passive: false },\n\t\t);\n\n\t\t// 双击重置\n\t\twrapper.addEventListener(\"dblclick\", () => {\n\t\t\tscale = 1;\n\t\t\ttx = 0;\n\t\t\tty = 0;\n\t\t\tapplyTransform();\n\t\t});\n\t\tapplyTransform();\n\t\tlet resizeTimer = null;\n\t\twindow.addEventListener(\"resize\", () => {\n\t\t\tclearTimeout(resizeTimer);\n\t\t\tresizeTimer = setTimeout(() => {\n\t\t\t\tapplyTransform();\n\t\t\t}, 200);\n\t\t});\n\t}\n\n\t// 设置其他事件监听器\n\tfunction setupEventListeners() {\n\t\t// 监听页面切换\n\t\tdocument.addEventListener(\"astro:page-load\", () => {\n\t\t\t// 重新初始化主题状态\n\t\t\tcurrentTheme = null;\n\t\t\tretryCount = 0; // 重置重试计数\n\t\t\tif (hasThemeChanged()) {\n\t\t\t\tsetTimeout(() => renderMermaidDiagrams(), 100);\n\t\t\t}\n\t\t});\n\n\t\t// 监听页面可见性变化，页面重新可见时重新渲染\n\t\tdocument.addEventListener(\"visibilitychange\", () => {\n\t\t\tif (!document.hidden) {\n\t\t\t\tsetTimeout(() => renderMermaidDiagrams(), 200);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync function initializeMermaid() {\n\t\ttry {\n\t\t\tawait waitForMermaid();\n\n\t\t\t// 初始化 Mermaid 配置\n\t\t\twindow.mermaid.initialize({\n\t\t\t\tstartOnLoad: false,\n\t\t\t\ttheme: \"default\",\n\t\t\t\tthemeVariables: {\n\t\t\t\t\tfontFamily: \"inherit\",\n\t\t\t\t\tfontSize: \"16px\",\n\t\t\t\t},\n\t\t\t\tsecurityLevel: \"loose\",\n\t\t\t\t// 添加错误处理配置\n\t\t\t\terrorLevel: \"warn\",\n\t\t\t\tlogLevel: \"error\",\n\t\t\t});\n\n\t\t\t// 渲染所有 Mermaid 图表\n\t\t\tawait renderMermaidDiagrams();\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Failed to initialize Mermaid:\", error);\n\t\t\t// 如果初始化失败，尝试重新加载\n\t\t\tif (retryCount < MAX_RETRIES) {\n\t\t\t\tretryCount++;\n\t\t\t\tsetTimeout(() => initializeMermaid(), RETRY_DELAY * retryCount);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync function renderMermaidDiagrams() {\n\t\t// 防止并发渲染\n\t\tif (isRendering) {\n\t\t\treturn;\n\t\t}\n\n\t\t// 检查 Mermaid 是否可用\n\t\tif (!window.mermaid || typeof window.mermaid.render !== \"function\") {\n\t\t\tconsole.warn(\"Mermaid not available, skipping render\");\n\t\t\treturn;\n\t\t}\n\n\t\tisRendering = true;\n\n\t\ttry {\n\t\t\tconst mermaidElements = document.querySelectorAll(\n\t\t\t\t\".mermaid[data-mermaid-code]\",\n\t\t\t);\n\n\t\t\tif (mermaidElements.length === 0) {\n\t\t\t\tisRendering = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// 延迟检测主题，确保 DOM 已经更新\n\t\t\tawait new Promise((resolve) => setTimeout(resolve, 100));\n\n\t\t\tconst htmlElement = document.documentElement;\n\t\t\tconst isDark = htmlElement.classList.contains(\"dark\");\n\t\t\tconst theme = isDark ? \"dark\" : \"default\";\n\n\t\t\t// 更新 Mermaid 主题（只需要更新一次）\n\t\t\twindow.mermaid.initialize({\n\t\t\t\tstartOnLoad: false,\n\t\t\t\ttheme: theme,\n\t\t\t\tthemeVariables: {\n\t\t\t\t\tfontFamily: \"inherit\",\n\t\t\t\t\tfontSize: \"16px\",\n\t\t\t\t\t// 强制应用主题变量\n\t\t\t\t\tprimaryColor: isDark ? \"#ffffff\" : \"#000000\",\n\t\t\t\t\tprimaryTextColor: isDark ? \"#ffffff\" : \"#000000\",\n\t\t\t\t\tprimaryBorderColor: isDark ? \"#ffffff\" : \"#000000\",\n\t\t\t\t\tlineColor: isDark ? \"#ffffff\" : \"#000000\",\n\t\t\t\t\tsecondaryColor: isDark ? \"#333333\" : \"#f0f0f0\",\n\t\t\t\t\ttertiaryColor: isDark ? \"#555555\" : \"#e0e0e0\",\n\t\t\t\t},\n\t\t\t\tsecurityLevel: \"loose\",\n\t\t\t\terrorLevel: \"warn\",\n\t\t\t\tlogLevel: \"error\",\n\t\t\t});\n\n\t\t\t// 批量渲染所有图表，添加重试机制\n\t\t\tconst renderPromises = Array.from(mermaidElements).map(\n\t\t\t\tasync (element, index) => {\n\t\t\t\t\tlet attempts = 0;\n\t\t\t\t\tconst maxAttempts = 3;\n\n\t\t\t\t\twhile (attempts < maxAttempts) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst code = element.getAttribute(\"data-mermaid-code\");\n\n\t\t\t\t\t\t\tif (!code) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// 显示加载状态\n\t\t\t\t\t\t\telement.innerHTML =\n\t\t\t\t\t\t\t\t'<div class=\"mermaid-loading\">Rendering diagram...</div>';\n\n\t\t\t\t\t\t\t// 渲染图表\n\t\t\t\t\t\t\tconst { svg } = await window.mermaid.render(\n\t\t\t\t\t\t\t\t`mermaid-${Date.now()}-${index}-${attempts}`,\n\t\t\t\t\t\t\t\tcode,\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tconst parser = new DOMParser();\n\t\t\t\t\t\t\tconst doc = parser.parseFromString(svg, \"image/svg+xml\");\n\t\t\t\t\t\t\tconst svgElement = doc.documentElement;\n\n\t\t\t\t\t\t\telement.innerHTML = \"\";\n\t\t\t\t\t\t\telement.__zoomAttached = false;\n\t\t\t\t\t\t\telement.appendChild(svgElement);\n\n\t\t\t\t\t\t\t// 添加响应式支持\n\t\t\t\t\t\t\tconst insertedSvg = element.querySelector(\"svg\");\n\t\t\t\t\t\t\tif (insertedSvg) {\n\t\t\t\t\t\t\t\tinsertedSvg.setAttribute(\"width\", \"100%\");\n\t\t\t\t\t\t\t\tinsertedSvg.removeAttribute(\"height\");\n\t\t\t\t\t\t\t\tinsertedSvg.style.maxWidth = \"100%\";\n\t\t\t\t\t\t\t\tinsertedSvg.style.height = \"auto\";\n\t\t\t\t\t\t\t\t//Todo 需要根据实际情况\n\t\t\t\t\t\t\t\tinsertedSvg.style.minHeight = \"300px\";\n\n\t\t\t\t\t\t\t\t// 强制应用样式\n\t\t\t\t\t\t\t\tif (isDark) {\n\t\t\t\t\t\t\t\t\tsvgElement.style.filter = \"brightness(0.9) contrast(1.1)\";\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tsvgElement.style.filter = \"none\";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tattachZoomControls(element, insertedSvg);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// 渲染成功，跳出重试循环\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tattempts++;\n\t\t\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\t\t`Mermaid rendering attempt ${attempts} failed for element ${index}:`,\n\t\t\t\t\t\t\t\terror,\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tif (attempts >= maxAttempts) {\n\t\t\t\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t\t\t\t`Failed to render Mermaid diagram after ${maxAttempts} attempts:`,\n\t\t\t\t\t\t\t\t\terror,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\telement.innerHTML = `\n\t\t\t\t\t\t\t\t\t<div class=\"mermaid-error\">\n\t\t\t\t\t\t\t\t\t\t<p>Failed to render diagram after ${maxAttempts} attempts.</p>\n\t\t\t\t\t\t\t\t\t\t<button onclick=\"location.reload()\" style=\"margin-top: 8px; padding: 4px 8px; background: var(--primary); color: white; border: none; border-radius: 4px; cursor: pointer;\">\n\t\t\t\t\t\t\t\t\t\t\tRetry Page\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t`;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// 等待一段时间后重试\n\t\t\t\t\t\t\t\tawait new Promise((resolve) =>\n\t\t\t\t\t\t\t\t\tsetTimeout(resolve, 500 * attempts),\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t);\n\n\t\t\t// 等待所有渲染完成\n\t\t\tawait Promise.all(renderPromises);\n\t\t\tretryCount = 0; // 重置重试计数\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error in renderMermaidDiagrams:\", error);\n\n\t\t\t// 如果渲染失败，尝试重新渲染\n\t\t\tif (retryCount < MAX_RETRIES) {\n\t\t\t\tretryCount++;\n\t\t\t\tsetTimeout(() => renderMermaidDiagrams(), RETRY_DELAY * retryCount);\n\t\t\t}\n\t\t} finally {\n\t\t\tisRendering = false;\n\t\t}\n\t}\n\n\t// 初始化主题状态\n\tfunction initializeThemeState() {\n\t\tconst isDark = document.documentElement.classList.contains(\"dark\");\n\t\tcurrentTheme = isDark ? \"dark\" : \"default\";\n\t}\n\n\t// 加载 Mermaid 库\n\tasync function loadMermaid() {\n\t\tif (typeof window.mermaid !== \"undefined\") {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst script = document.createElement(\"script\");\n\t\t\tscript.src =\n\t\t\t\t\"https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js\";\n\n\t\t\tscript.onload = () => {\n\t\t\t\tconsole.log(\"Mermaid library loaded successfully\");\n\t\t\t\tresolve();\n\t\t\t};\n\n\t\t\tscript.onerror = (error) => {\n\t\t\t\tconsole.error(\"Failed to load Mermaid library:\", error);\n\t\t\t\t// 尝试备用 CDN\n\t\t\t\tconst fallbackScript = document.createElement(\"script\");\n\t\t\t\tfallbackScript.src = \"https://unpkg.com/mermaid@11/dist/mermaid.min.js\";\n\n\t\t\t\tfallbackScript.onload = () => {\n\t\t\t\t\tconsole.log(\"Mermaid library loaded from fallback CDN\");\n\t\t\t\t\tresolve();\n\t\t\t\t};\n\n\t\t\t\tfallbackScript.onerror = () => {\n\t\t\t\t\treject(\n\t\t\t\t\t\tnew Error(\n\t\t\t\t\t\t\t\"Failed to load Mermaid from both primary and fallback CDNs\",\n\t\t\t\t\t\t),\n\t\t\t\t\t);\n\t\t\t\t};\n\n\t\t\t\tdocument.head.appendChild(fallbackScript);\n\t\t\t};\n\n\t\t\tdocument.head.appendChild(script);\n\t\t});\n\t}\n\n\t// 主初始化函数\n\tasync function initialize() {\n\t\ttry {\n\t\t\t// 设置监听器\n\t\t\tsetupMutationObserver();\n\t\t\tsetupEventListeners();\n\n\t\t\t// 初始化主题状态\n\t\t\tinitializeThemeState();\n\n\t\t\t// 加载并初始化 Mermaid\n\t\t\tawait loadMermaid();\n\t\t\tawait initializeMermaid();\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Failed to initialize Mermaid system:\", error);\n\t\t}\n\t}\n\n\t// 启动初始化\n\tif (document.readyState === \"loading\") {\n\t\tdocument.addEventListener(\"DOMContentLoaded\", initialize);\n\t} else {\n\t\tinitialize();\n\t}\n})();\n</script></div></section><section><h2 id=\"state-diagram-example\">State Diagram Example<a class=\"anchor\" href=\"#state-diagram-example\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>State diagrams show the sequence of states an object goes through during its life cycle.</p><div class=\"mermaid-diagram-container\"><div class=\"mermaid-wrapper\" id=\"mermaid-msr9ro\"><div class=\"mermaid\" data-mermaid-code=\"stateDiagram-v2\n    [*] --> Draft\n    \n    Draft --> UnderReview : submit\n    UnderReview --> Draft : reject\n    UnderReview --> Approved : approve\n    Approved --> Published : publish\n    Published --> Archived : archive\n    Published --> Draft : retract\n    \n    state Published {\n        [*] --> Active\n        Active --> Hidden : temporarily hide\n        Hidden --> Active : restore\n        Active --> [*]\n        Hidden --> [*]\n    }\n    \n    Archived --> [*]\">stateDiagram-v2\n    [*] --> Draft\n    \n    Draft --> UnderReview : submit\n    UnderReview --> Draft : reject\n    UnderReview --> Approved : approve\n    Approved --> Published : publish\n    Published --> Archived : archive\n    Published --> Draft : retract\n    \n    state Published {\n        [*] --> Active\n        Active --> Hidden : temporarily hide\n        Hidden --> Active : restore\n        Active --> [*]\n        Hidden --> [*]\n    }\n    \n    Archived --> [*]</div></div><script type=\"text/javascript\">(() => {\n\t// 单例模式：检查是否已经初始化过\n\tif (window.mermaidInitialized) {\n\t\treturn;\n\t}\n\n\twindow.mermaidInitialized = true;\n\n\t// 记录当前主题状态，避免不必要的重新渲染\n\tlet currentTheme = null;\n\tlet isRendering = false; // 防止并发渲染\n\tlet retryCount = 0;\n\tconst MAX_RETRIES = 3;\n\tconst RETRY_DELAY = 1000; // 1秒\n\n\t// 检查主题是否真的发生了变化\n\tfunction hasThemeChanged() {\n\t\tconst isDark = document.documentElement.classList.contains(\"dark\");\n\t\tconst newTheme = isDark ? \"dark\" : \"default\";\n\n\t\tif (currentTheme !== newTheme) {\n\t\t\tcurrentTheme = newTheme;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t// 等待 Mermaid 库加载完成\n\tfunction waitForMermaid(timeout = 10000) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst startTime = Date.now();\n\n\t\t\tfunction check() {\n\t\t\t\tif (window.mermaid && typeof window.mermaid.initialize === \"function\") {\n\t\t\t\t\tresolve(window.mermaid);\n\t\t\t\t} else if (Date.now() - startTime > timeout) {\n\t\t\t\t\treject(new Error(\"Mermaid library failed to load within timeout\"));\n\t\t\t\t} else {\n\t\t\t\t\tsetTimeout(check, 100);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcheck();\n\t\t});\n\t}\n\n\t// 设置 MutationObserver 监听 html 元素的 class 属性变化\n\tfunction setupMutationObserver() {\n\t\tconst observer = new MutationObserver((mutations) => {\n\t\t\tmutations.forEach((mutation) => {\n\t\t\t\tif (\n\t\t\t\t\tmutation.type === \"attributes\" &&\n\t\t\t\t\tmutation.attributeName === \"class\"\n\t\t\t\t) {\n\t\t\t\t\t// 检查是否是 dark 类的变化\n\t\t\t\t\tconst target = mutation.target;\n\t\t\t\t\tconst wasDark = mutation.oldValue\n\t\t\t\t\t\t? mutation.oldValue.includes(\"dark\")\n\t\t\t\t\t\t: false;\n\t\t\t\t\tconst isDark = target.classList.contains(\"dark\");\n\n\t\t\t\t\tif (wasDark !== isDark) {\n\t\t\t\t\t\tif (hasThemeChanged()) {\n\t\t\t\t\t\t\t// 延迟渲染，避免主题切换时的闪烁\n\t\t\t\t\t\t\tsetTimeout(() => renderMermaidDiagrams(), 150);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t// 开始观察 html 元素的 class 属性变化\n\t\tobserver.observe(document.documentElement, {\n\t\t\tattributes: true,\n\t\t\tattributeFilter: [\"class\"],\n\t\t\tattributeOldValue: true,\n\t\t});\n\t}\n\n\t// 缩放平移\n\tfunction attachZoomControls(element, svgElement) {\n\t\tif (element.__zoomAttached) return;\n\t\telement.__zoomAttached = true;\n\n\t\tconst wrapper = document.createElement(\"div\");\n\t\twrapper.className = \"mermaid-zoom-wrapper\";\n\n\t\tconst svgParent = svgElement.parentNode;\n\t\twrapper.appendChild(svgElement);\n\t\tsvgParent.appendChild(wrapper);\n\n\t\tlet scale = 1;\n\t\tlet tx = 0;\n\t\tlet ty = 0;\n\t\tconst MIN_SCALE = 0.2;\n\t\tconst MAX_SCALE = 6;\n\n\t\tfunction applyTransform() {\n\t\t\twrapper.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`;\n\t\t}\n\t\tconst controls = document.createElement(\"div\");\n\t\tcontrols.className = \"mermaid-zoom-controls\";\n\t\tcontrols.innerHTML = `\n\t\t\t<button class=\"btn-regular rounded-lg h-10 w-10 active:scale-90\" data-action=\"zoom-in\" title=\"Zoom in\">+</button>\n\t\t\t<button class=\"btn-regular rounded-lg h-10 w-10 active:scale-90\" data-action=\"zoom-out\" title=\"Zoom out\">−</button>\n\t\t\t<button class=\"btn-regular rounded-lg h-10 w-10 active:scale-90\" data-action=\"reset\" title=\"Reset\">⤾</button>\n\t\t`;\n\t\telement.appendChild(controls);\n\n\t\tcontrols.addEventListener(\"click\", (ev) => {\n\t\t\tconst action =\n\t\t\t\tev.target.getAttribute && ev.target.getAttribute(\"data-action\");\n\t\t\tif (!action) return;\n\n\t\t\tswitch (action) {\n\t\t\t\tcase \"zoom-in\":\n\t\t\t\t\tscale = Math.min(MAX_SCALE, +(scale * 1.2).toFixed(3));\n\t\t\t\t\tapplyTransform();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"zoom-out\":\n\t\t\t\t\tscale = Math.max(MIN_SCALE, +(scale / 1.2).toFixed(3));\n\t\t\t\t\tapplyTransform();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"reset\":\n\t\t\t\t\tscale = 1;\n\t\t\t\t\ttx = 0;\n\t\t\t\t\tty = 0;\n\t\t\t\t\tapplyTransform();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\n\t\tlet isPanning = false;\n\t\tlet startX = 0;\n\t\tlet startY = 0;\n\t\tlet startTx = 0;\n\t\tlet startTy = 0;\n\n\t\twrapper.style.touchAction = \"none\";\n\n\t\twrapper.addEventListener(\"pointerdown\", (ev) => {\n\t\t\tif (ev.button !== 0) return; // 仅左键\n\t\t\tisPanning = true;\n\t\t\twrapper.setPointerCapture(ev.pointerId);\n\t\t\tstartX = ev.clientX;\n\t\t\tstartY = ev.clientY;\n\t\t\tstartTx = tx;\n\t\t\tstartTy = ty;\n\t\t});\n\n\t\twrapper.addEventListener(\"pointermove\", (ev) => {\n\t\t\tif (!isPanning) return;\n\t\t\tconst dx = ev.clientX - startX;\n\t\t\tconst dy = ev.clientY - startY;\n\t\t\ttx = startTx + dx / scale; // 根据当前缩放调整灵敏度\n\t\t\tty = startTy + dy / scale;\n\t\t\tapplyTransform();\n\t\t});\n\n\t\twrapper.addEventListener(\"pointerup\", (ev) => {\n\t\t\tisPanning = false;\n\t\t\ttry {\n\t\t\t\twrapper.releasePointerCapture(ev.pointerId);\n\t\t\t} catch (e) {}\n\t\t});\n\n\t\twrapper.addEventListener(\"pointercancel\", () => {\n\t\t\tisPanning = false;\n\t\t});\n\n\t\t// 鼠标滚轮缩放\n\t\telement.addEventListener(\n\t\t\t\"wheel\",\n\t\t\t(ev) => {\n\t\t\t\tev.preventDefault();\n\t\t\t\tconst delta = -ev.deltaY;\n\t\t\t\tconst zoomFactor = delta > 0 ? 1.12 : 1 / 1.12;\n\t\t\t\tconst prevScale = scale;\n\t\t\t\tscale = Math.min(\n\t\t\t\t\tMAX_SCALE,\n\t\t\t\t\tMath.max(MIN_SCALE, +(scale * zoomFactor).toFixed(3)),\n\t\t\t\t);\n\n\t\t\t\tconst rect = wrapper.getBoundingClientRect();\n\t\t\t\tconst cx = ev.clientX - rect.left;\n\t\t\t\tconst cy = ev.clientY - rect.top;\n\n\t\t\t\tconst worldX = cx / prevScale - tx;\n\t\t\t\tconst worldY = cy / prevScale - ty;\n\n\t\t\t\ttx = cx / scale - worldX;\n\t\t\t\tty = cy / scale - worldY;\n\n\t\t\t\tapplyTransform();\n\t\t\t},\n\t\t\t{ passive: false },\n\t\t);\n\n\t\t// 双击重置\n\t\twrapper.addEventListener(\"dblclick\", () => {\n\t\t\tscale = 1;\n\t\t\ttx = 0;\n\t\t\tty = 0;\n\t\t\tapplyTransform();\n\t\t});\n\t\tapplyTransform();\n\t\tlet resizeTimer = null;\n\t\twindow.addEventListener(\"resize\", () => {\n\t\t\tclearTimeout(resizeTimer);\n\t\t\tresizeTimer = setTimeout(() => {\n\t\t\t\tapplyTransform();\n\t\t\t}, 200);\n\t\t});\n\t}\n\n\t// 设置其他事件监听器\n\tfunction setupEventListeners() {\n\t\t// 监听页面切换\n\t\tdocument.addEventListener(\"astro:page-load\", () => {\n\t\t\t// 重新初始化主题状态\n\t\t\tcurrentTheme = null;\n\t\t\tretryCount = 0; // 重置重试计数\n\t\t\tif (hasThemeChanged()) {\n\t\t\t\tsetTimeout(() => renderMermaidDiagrams(), 100);\n\t\t\t}\n\t\t});\n\n\t\t// 监听页面可见性变化，页面重新可见时重新渲染\n\t\tdocument.addEventListener(\"visibilitychange\", () => {\n\t\t\tif (!document.hidden) {\n\t\t\t\tsetTimeout(() => renderMermaidDiagrams(), 200);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync function initializeMermaid() {\n\t\ttry {\n\t\t\tawait waitForMermaid();\n\n\t\t\t// 初始化 Mermaid 配置\n\t\t\twindow.mermaid.initialize({\n\t\t\t\tstartOnLoad: false,\n\t\t\t\ttheme: \"default\",\n\t\t\t\tthemeVariables: {\n\t\t\t\t\tfontFamily: \"inherit\",\n\t\t\t\t\tfontSize: \"16px\",\n\t\t\t\t},\n\t\t\t\tsecurityLevel: \"loose\",\n\t\t\t\t// 添加错误处理配置\n\t\t\t\terrorLevel: \"warn\",\n\t\t\t\tlogLevel: \"error\",\n\t\t\t});\n\n\t\t\t// 渲染所有 Mermaid 图表\n\t\t\tawait renderMermaidDiagrams();\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Failed to initialize Mermaid:\", error);\n\t\t\t// 如果初始化失败，尝试重新加载\n\t\t\tif (retryCount < MAX_RETRIES) {\n\t\t\t\tretryCount++;\n\t\t\t\tsetTimeout(() => initializeMermaid(), RETRY_DELAY * retryCount);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync function renderMermaidDiagrams() {\n\t\t// 防止并发渲染\n\t\tif (isRendering) {\n\t\t\treturn;\n\t\t}\n\n\t\t// 检查 Mermaid 是否可用\n\t\tif (!window.mermaid || typeof window.mermaid.render !== \"function\") {\n\t\t\tconsole.warn(\"Mermaid not available, skipping render\");\n\t\t\treturn;\n\t\t}\n\n\t\tisRendering = true;\n\n\t\ttry {\n\t\t\tconst mermaidElements = document.querySelectorAll(\n\t\t\t\t\".mermaid[data-mermaid-code]\",\n\t\t\t);\n\n\t\t\tif (mermaidElements.length === 0) {\n\t\t\t\tisRendering = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// 延迟检测主题，确保 DOM 已经更新\n\t\t\tawait new Promise((resolve) => setTimeout(resolve, 100));\n\n\t\t\tconst htmlElement = document.documentElement;\n\t\t\tconst isDark = htmlElement.classList.contains(\"dark\");\n\t\t\tconst theme = isDark ? \"dark\" : \"default\";\n\n\t\t\t// 更新 Mermaid 主题（只需要更新一次）\n\t\t\twindow.mermaid.initialize({\n\t\t\t\tstartOnLoad: false,\n\t\t\t\ttheme: theme,\n\t\t\t\tthemeVariables: {\n\t\t\t\t\tfontFamily: \"inherit\",\n\t\t\t\t\tfontSize: \"16px\",\n\t\t\t\t\t// 强制应用主题变量\n\t\t\t\t\tprimaryColor: isDark ? \"#ffffff\" : \"#000000\",\n\t\t\t\t\tprimaryTextColor: isDark ? \"#ffffff\" : \"#000000\",\n\t\t\t\t\tprimaryBorderColor: isDark ? \"#ffffff\" : \"#000000\",\n\t\t\t\t\tlineColor: isDark ? \"#ffffff\" : \"#000000\",\n\t\t\t\t\tsecondaryColor: isDark ? \"#333333\" : \"#f0f0f0\",\n\t\t\t\t\ttertiaryColor: isDark ? \"#555555\" : \"#e0e0e0\",\n\t\t\t\t},\n\t\t\t\tsecurityLevel: \"loose\",\n\t\t\t\terrorLevel: \"warn\",\n\t\t\t\tlogLevel: \"error\",\n\t\t\t});\n\n\t\t\t// 批量渲染所有图表，添加重试机制\n\t\t\tconst renderPromises = Array.from(mermaidElements).map(\n\t\t\t\tasync (element, index) => {\n\t\t\t\t\tlet attempts = 0;\n\t\t\t\t\tconst maxAttempts = 3;\n\n\t\t\t\t\twhile (attempts < maxAttempts) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst code = element.getAttribute(\"data-mermaid-code\");\n\n\t\t\t\t\t\t\tif (!code) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// 显示加载状态\n\t\t\t\t\t\t\telement.innerHTML =\n\t\t\t\t\t\t\t\t'<div class=\"mermaid-loading\">Rendering diagram...</div>';\n\n\t\t\t\t\t\t\t// 渲染图表\n\t\t\t\t\t\t\tconst { svg } = await window.mermaid.render(\n\t\t\t\t\t\t\t\t`mermaid-${Date.now()}-${index}-${attempts}`,\n\t\t\t\t\t\t\t\tcode,\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tconst parser = new DOMParser();\n\t\t\t\t\t\t\tconst doc = parser.parseFromString(svg, \"image/svg+xml\");\n\t\t\t\t\t\t\tconst svgElement = doc.documentElement;\n\n\t\t\t\t\t\t\telement.innerHTML = \"\";\n\t\t\t\t\t\t\telement.__zoomAttached = false;\n\t\t\t\t\t\t\telement.appendChild(svgElement);\n\n\t\t\t\t\t\t\t// 添加响应式支持\n\t\t\t\t\t\t\tconst insertedSvg = element.querySelector(\"svg\");\n\t\t\t\t\t\t\tif (insertedSvg) {\n\t\t\t\t\t\t\t\tinsertedSvg.setAttribute(\"width\", \"100%\");\n\t\t\t\t\t\t\t\tinsertedSvg.removeAttribute(\"height\");\n\t\t\t\t\t\t\t\tinsertedSvg.style.maxWidth = \"100%\";\n\t\t\t\t\t\t\t\tinsertedSvg.style.height = \"auto\";\n\t\t\t\t\t\t\t\t//Todo 需要根据实际情况\n\t\t\t\t\t\t\t\tinsertedSvg.style.minHeight = \"300px\";\n\n\t\t\t\t\t\t\t\t// 强制应用样式\n\t\t\t\t\t\t\t\tif (isDark) {\n\t\t\t\t\t\t\t\t\tsvgElement.style.filter = \"brightness(0.9) contrast(1.1)\";\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tsvgElement.style.filter = \"none\";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tattachZoomControls(element, insertedSvg);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// 渲染成功，跳出重试循环\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tattempts++;\n\t\t\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\t\t`Mermaid rendering attempt ${attempts} failed for element ${index}:`,\n\t\t\t\t\t\t\t\terror,\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tif (attempts >= maxAttempts) {\n\t\t\t\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t\t\t\t`Failed to render Mermaid diagram after ${maxAttempts} attempts:`,\n\t\t\t\t\t\t\t\t\terror,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\telement.innerHTML = `\n\t\t\t\t\t\t\t\t\t<div class=\"mermaid-error\">\n\t\t\t\t\t\t\t\t\t\t<p>Failed to render diagram after ${maxAttempts} attempts.</p>\n\t\t\t\t\t\t\t\t\t\t<button onclick=\"location.reload()\" style=\"margin-top: 8px; padding: 4px 8px; background: var(--primary); color: white; border: none; border-radius: 4px; cursor: pointer;\">\n\t\t\t\t\t\t\t\t\t\t\tRetry Page\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t`;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// 等待一段时间后重试\n\t\t\t\t\t\t\t\tawait new Promise((resolve) =>\n\t\t\t\t\t\t\t\t\tsetTimeout(resolve, 500 * attempts),\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t);\n\n\t\t\t// 等待所有渲染完成\n\t\t\tawait Promise.all(renderPromises);\n\t\t\tretryCount = 0; // 重置重试计数\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error in renderMermaidDiagrams:\", error);\n\n\t\t\t// 如果渲染失败，尝试重新渲染\n\t\t\tif (retryCount < MAX_RETRIES) {\n\t\t\t\tretryCount++;\n\t\t\t\tsetTimeout(() => renderMermaidDiagrams(), RETRY_DELAY * retryCount);\n\t\t\t}\n\t\t} finally {\n\t\t\tisRendering = false;\n\t\t}\n\t}\n\n\t// 初始化主题状态\n\tfunction initializeThemeState() {\n\t\tconst isDark = document.documentElement.classList.contains(\"dark\");\n\t\tcurrentTheme = isDark ? \"dark\" : \"default\";\n\t}\n\n\t// 加载 Mermaid 库\n\tasync function loadMermaid() {\n\t\tif (typeof window.mermaid !== \"undefined\") {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst script = document.createElement(\"script\");\n\t\t\tscript.src =\n\t\t\t\t\"https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js\";\n\n\t\t\tscript.onload = () => {\n\t\t\t\tconsole.log(\"Mermaid library loaded successfully\");\n\t\t\t\tresolve();\n\t\t\t};\n\n\t\t\tscript.onerror = (error) => {\n\t\t\t\tconsole.error(\"Failed to load Mermaid library:\", error);\n\t\t\t\t// 尝试备用 CDN\n\t\t\t\tconst fallbackScript = document.createElement(\"script\");\n\t\t\t\tfallbackScript.src = \"https://unpkg.com/mermaid@11/dist/mermaid.min.js\";\n\n\t\t\t\tfallbackScript.onload = () => {\n\t\t\t\t\tconsole.log(\"Mermaid library loaded from fallback CDN\");\n\t\t\t\t\tresolve();\n\t\t\t\t};\n\n\t\t\t\tfallbackScript.onerror = () => {\n\t\t\t\t\treject(\n\t\t\t\t\t\tnew Error(\n\t\t\t\t\t\t\t\"Failed to load Mermaid from both primary and fallback CDNs\",\n\t\t\t\t\t\t),\n\t\t\t\t\t);\n\t\t\t\t};\n\n\t\t\t\tdocument.head.appendChild(fallbackScript);\n\t\t\t};\n\n\t\t\tdocument.head.appendChild(script);\n\t\t});\n\t}\n\n\t// 主初始化函数\n\tasync function initialize() {\n\t\ttry {\n\t\t\t// 设置监听器\n\t\t\tsetupMutationObserver();\n\t\t\tsetupEventListeners();\n\n\t\t\t// 初始化主题状态\n\t\t\tinitializeThemeState();\n\n\t\t\t// 加载并初始化 Mermaid\n\t\t\tawait loadMermaid();\n\t\t\tawait initializeMermaid();\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Failed to initialize Mermaid system:\", error);\n\t\t}\n\t}\n\n\t// 启动初始化\n\tif (document.readyState === \"loading\") {\n\t\tdocument.addEventListener(\"DOMContentLoaded\", initialize);\n\t} else {\n\t\tinitialize();\n\t}\n})();\n</script></div></section><section><h2 id=\"pie-chart-example\">Pie Chart Example<a class=\"anchor\" href=\"#pie-chart-example\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>Pie charts are ideal for displaying proportions and percentage data.</p><div class=\"mermaid-diagram-container\"><div class=\"mermaid-wrapper\" id=\"mermaid-2l7wah\"><div class=\"mermaid\" data-mermaid-code=\"pie title Website Traffic Sources Analysis\n    &#x22;Search Engines&#x22; : 45.6\n    &#x22;Direct Access&#x22; : 30.1\n    &#x22;Social Media&#x22; : 15.3\n    &#x22;Referral Links&#x22; : 6.4\n    &#x22;Other Sources&#x22; : 2.6\">pie title Website Traffic Sources Analysis\n    \"Search Engines\" : 45.6\n    \"Direct Access\" : 30.1\n    \"Social Media\" : 15.3\n    \"Referral Links\" : 6.4\n    \"Other Sources\" : 2.6</div></div><script type=\"text/javascript\">(() => {\n\t// 单例模式：检查是否已经初始化过\n\tif (window.mermaidInitialized) {\n\t\treturn;\n\t}\n\n\twindow.mermaidInitialized = true;\n\n\t// 记录当前主题状态，避免不必要的重新渲染\n\tlet currentTheme = null;\n\tlet isRendering = false; // 防止并发渲染\n\tlet retryCount = 0;\n\tconst MAX_RETRIES = 3;\n\tconst RETRY_DELAY = 1000; // 1秒\n\n\t// 检查主题是否真的发生了变化\n\tfunction hasThemeChanged() {\n\t\tconst isDark = document.documentElement.classList.contains(\"dark\");\n\t\tconst newTheme = isDark ? \"dark\" : \"default\";\n\n\t\tif (currentTheme !== newTheme) {\n\t\t\tcurrentTheme = newTheme;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t// 等待 Mermaid 库加载完成\n\tfunction waitForMermaid(timeout = 10000) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst startTime = Date.now();\n\n\t\t\tfunction check() {\n\t\t\t\tif (window.mermaid && typeof window.mermaid.initialize === \"function\") {\n\t\t\t\t\tresolve(window.mermaid);\n\t\t\t\t} else if (Date.now() - startTime > timeout) {\n\t\t\t\t\treject(new Error(\"Mermaid library failed to load within timeout\"));\n\t\t\t\t} else {\n\t\t\t\t\tsetTimeout(check, 100);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcheck();\n\t\t});\n\t}\n\n\t// 设置 MutationObserver 监听 html 元素的 class 属性变化\n\tfunction setupMutationObserver() {\n\t\tconst observer = new MutationObserver((mutations) => {\n\t\t\tmutations.forEach((mutation) => {\n\t\t\t\tif (\n\t\t\t\t\tmutation.type === \"attributes\" &&\n\t\t\t\t\tmutation.attributeName === \"class\"\n\t\t\t\t) {\n\t\t\t\t\t// 检查是否是 dark 类的变化\n\t\t\t\t\tconst target = mutation.target;\n\t\t\t\t\tconst wasDark = mutation.oldValue\n\t\t\t\t\t\t? mutation.oldValue.includes(\"dark\")\n\t\t\t\t\t\t: false;\n\t\t\t\t\tconst isDark = target.classList.contains(\"dark\");\n\n\t\t\t\t\tif (wasDark !== isDark) {\n\t\t\t\t\t\tif (hasThemeChanged()) {\n\t\t\t\t\t\t\t// 延迟渲染，避免主题切换时的闪烁\n\t\t\t\t\t\t\tsetTimeout(() => renderMermaidDiagrams(), 150);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t// 开始观察 html 元素的 class 属性变化\n\t\tobserver.observe(document.documentElement, {\n\t\t\tattributes: true,\n\t\t\tattributeFilter: [\"class\"],\n\t\t\tattributeOldValue: true,\n\t\t});\n\t}\n\n\t// 缩放平移\n\tfunction attachZoomControls(element, svgElement) {\n\t\tif (element.__zoomAttached) return;\n\t\telement.__zoomAttached = true;\n\n\t\tconst wrapper = document.createElement(\"div\");\n\t\twrapper.className = \"mermaid-zoom-wrapper\";\n\n\t\tconst svgParent = svgElement.parentNode;\n\t\twrapper.appendChild(svgElement);\n\t\tsvgParent.appendChild(wrapper);\n\n\t\tlet scale = 1;\n\t\tlet tx = 0;\n\t\tlet ty = 0;\n\t\tconst MIN_SCALE = 0.2;\n\t\tconst MAX_SCALE = 6;\n\n\t\tfunction applyTransform() {\n\t\t\twrapper.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`;\n\t\t}\n\t\tconst controls = document.createElement(\"div\");\n\t\tcontrols.className = \"mermaid-zoom-controls\";\n\t\tcontrols.innerHTML = `\n\t\t\t<button class=\"btn-regular rounded-lg h-10 w-10 active:scale-90\" data-action=\"zoom-in\" title=\"Zoom in\">+</button>\n\t\t\t<button class=\"btn-regular rounded-lg h-10 w-10 active:scale-90\" data-action=\"zoom-out\" title=\"Zoom out\">−</button>\n\t\t\t<button class=\"btn-regular rounded-lg h-10 w-10 active:scale-90\" data-action=\"reset\" title=\"Reset\">⤾</button>\n\t\t`;\n\t\telement.appendChild(controls);\n\n\t\tcontrols.addEventListener(\"click\", (ev) => {\n\t\t\tconst action =\n\t\t\t\tev.target.getAttribute && ev.target.getAttribute(\"data-action\");\n\t\t\tif (!action) return;\n\n\t\t\tswitch (action) {\n\t\t\t\tcase \"zoom-in\":\n\t\t\t\t\tscale = Math.min(MAX_SCALE, +(scale * 1.2).toFixed(3));\n\t\t\t\t\tapplyTransform();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"zoom-out\":\n\t\t\t\t\tscale = Math.max(MIN_SCALE, +(scale / 1.2).toFixed(3));\n\t\t\t\t\tapplyTransform();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"reset\":\n\t\t\t\t\tscale = 1;\n\t\t\t\t\ttx = 0;\n\t\t\t\t\tty = 0;\n\t\t\t\t\tapplyTransform();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\n\t\tlet isPanning = false;\n\t\tlet startX = 0;\n\t\tlet startY = 0;\n\t\tlet startTx = 0;\n\t\tlet startTy = 0;\n\n\t\twrapper.style.touchAction = \"none\";\n\n\t\twrapper.addEventListener(\"pointerdown\", (ev) => {\n\t\t\tif (ev.button !== 0) return; // 仅左键\n\t\t\tisPanning = true;\n\t\t\twrapper.setPointerCapture(ev.pointerId);\n\t\t\tstartX = ev.clientX;\n\t\t\tstartY = ev.clientY;\n\t\t\tstartTx = tx;\n\t\t\tstartTy = ty;\n\t\t});\n\n\t\twrapper.addEventListener(\"pointermove\", (ev) => {\n\t\t\tif (!isPanning) return;\n\t\t\tconst dx = ev.clientX - startX;\n\t\t\tconst dy = ev.clientY - startY;\n\t\t\ttx = startTx + dx / scale; // 根据当前缩放调整灵敏度\n\t\t\tty = startTy + dy / scale;\n\t\t\tapplyTransform();\n\t\t});\n\n\t\twrapper.addEventListener(\"pointerup\", (ev) => {\n\t\t\tisPanning = false;\n\t\t\ttry {\n\t\t\t\twrapper.releasePointerCapture(ev.pointerId);\n\t\t\t} catch (e) {}\n\t\t});\n\n\t\twrapper.addEventListener(\"pointercancel\", () => {\n\t\t\tisPanning = false;\n\t\t});\n\n\t\t// 鼠标滚轮缩放\n\t\telement.addEventListener(\n\t\t\t\"wheel\",\n\t\t\t(ev) => {\n\t\t\t\tev.preventDefault();\n\t\t\t\tconst delta = -ev.deltaY;\n\t\t\t\tconst zoomFactor = delta > 0 ? 1.12 : 1 / 1.12;\n\t\t\t\tconst prevScale = scale;\n\t\t\t\tscale = Math.min(\n\t\t\t\t\tMAX_SCALE,\n\t\t\t\t\tMath.max(MIN_SCALE, +(scale * zoomFactor).toFixed(3)),\n\t\t\t\t);\n\n\t\t\t\tconst rect = wrapper.getBoundingClientRect();\n\t\t\t\tconst cx = ev.clientX - rect.left;\n\t\t\t\tconst cy = ev.clientY - rect.top;\n\n\t\t\t\tconst worldX = cx / prevScale - tx;\n\t\t\t\tconst worldY = cy / prevScale - ty;\n\n\t\t\t\ttx = cx / scale - worldX;\n\t\t\t\tty = cy / scale - worldY;\n\n\t\t\t\tapplyTransform();\n\t\t\t},\n\t\t\t{ passive: false },\n\t\t);\n\n\t\t// 双击重置\n\t\twrapper.addEventListener(\"dblclick\", () => {\n\t\t\tscale = 1;\n\t\t\ttx = 0;\n\t\t\tty = 0;\n\t\t\tapplyTransform();\n\t\t});\n\t\tapplyTransform();\n\t\tlet resizeTimer = null;\n\t\twindow.addEventListener(\"resize\", () => {\n\t\t\tclearTimeout(resizeTimer);\n\t\t\tresizeTimer = setTimeout(() => {\n\t\t\t\tapplyTransform();\n\t\t\t}, 200);\n\t\t});\n\t}\n\n\t// 设置其他事件监听器\n\tfunction setupEventListeners() {\n\t\t// 监听页面切换\n\t\tdocument.addEventListener(\"astro:page-load\", () => {\n\t\t\t// 重新初始化主题状态\n\t\t\tcurrentTheme = null;\n\t\t\tretryCount = 0; // 重置重试计数\n\t\t\tif (hasThemeChanged()) {\n\t\t\t\tsetTimeout(() => renderMermaidDiagrams(), 100);\n\t\t\t}\n\t\t});\n\n\t\t// 监听页面可见性变化，页面重新可见时重新渲染\n\t\tdocument.addEventListener(\"visibilitychange\", () => {\n\t\t\tif (!document.hidden) {\n\t\t\t\tsetTimeout(() => renderMermaidDiagrams(), 200);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync function initializeMermaid() {\n\t\ttry {\n\t\t\tawait waitForMermaid();\n\n\t\t\t// 初始化 Mermaid 配置\n\t\t\twindow.mermaid.initialize({\n\t\t\t\tstartOnLoad: false,\n\t\t\t\ttheme: \"default\",\n\t\t\t\tthemeVariables: {\n\t\t\t\t\tfontFamily: \"inherit\",\n\t\t\t\t\tfontSize: \"16px\",\n\t\t\t\t},\n\t\t\t\tsecurityLevel: \"loose\",\n\t\t\t\t// 添加错误处理配置\n\t\t\t\terrorLevel: \"warn\",\n\t\t\t\tlogLevel: \"error\",\n\t\t\t});\n\n\t\t\t// 渲染所有 Mermaid 图表\n\t\t\tawait renderMermaidDiagrams();\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Failed to initialize Mermaid:\", error);\n\t\t\t// 如果初始化失败，尝试重新加载\n\t\t\tif (retryCount < MAX_RETRIES) {\n\t\t\t\tretryCount++;\n\t\t\t\tsetTimeout(() => initializeMermaid(), RETRY_DELAY * retryCount);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync function renderMermaidDiagrams() {\n\t\t// 防止并发渲染\n\t\tif (isRendering) {\n\t\t\treturn;\n\t\t}\n\n\t\t// 检查 Mermaid 是否可用\n\t\tif (!window.mermaid || typeof window.mermaid.render !== \"function\") {\n\t\t\tconsole.warn(\"Mermaid not available, skipping render\");\n\t\t\treturn;\n\t\t}\n\n\t\tisRendering = true;\n\n\t\ttry {\n\t\t\tconst mermaidElements = document.querySelectorAll(\n\t\t\t\t\".mermaid[data-mermaid-code]\",\n\t\t\t);\n\n\t\t\tif (mermaidElements.length === 0) {\n\t\t\t\tisRendering = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// 延迟检测主题，确保 DOM 已经更新\n\t\t\tawait new Promise((resolve) => setTimeout(resolve, 100));\n\n\t\t\tconst htmlElement = document.documentElement;\n\t\t\tconst isDark = htmlElement.classList.contains(\"dark\");\n\t\t\tconst theme = isDark ? \"dark\" : \"default\";\n\n\t\t\t// 更新 Mermaid 主题（只需要更新一次）\n\t\t\twindow.mermaid.initialize({\n\t\t\t\tstartOnLoad: false,\n\t\t\t\ttheme: theme,\n\t\t\t\tthemeVariables: {\n\t\t\t\t\tfontFamily: \"inherit\",\n\t\t\t\t\tfontSize: \"16px\",\n\t\t\t\t\t// 强制应用主题变量\n\t\t\t\t\tprimaryColor: isDark ? \"#ffffff\" : \"#000000\",\n\t\t\t\t\tprimaryTextColor: isDark ? \"#ffffff\" : \"#000000\",\n\t\t\t\t\tprimaryBorderColor: isDark ? \"#ffffff\" : \"#000000\",\n\t\t\t\t\tlineColor: isDark ? \"#ffffff\" : \"#000000\",\n\t\t\t\t\tsecondaryColor: isDark ? \"#333333\" : \"#f0f0f0\",\n\t\t\t\t\ttertiaryColor: isDark ? \"#555555\" : \"#e0e0e0\",\n\t\t\t\t},\n\t\t\t\tsecurityLevel: \"loose\",\n\t\t\t\terrorLevel: \"warn\",\n\t\t\t\tlogLevel: \"error\",\n\t\t\t});\n\n\t\t\t// 批量渲染所有图表，添加重试机制\n\t\t\tconst renderPromises = Array.from(mermaidElements).map(\n\t\t\t\tasync (element, index) => {\n\t\t\t\t\tlet attempts = 0;\n\t\t\t\t\tconst maxAttempts = 3;\n\n\t\t\t\t\twhile (attempts < maxAttempts) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst code = element.getAttribute(\"data-mermaid-code\");\n\n\t\t\t\t\t\t\tif (!code) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// 显示加载状态\n\t\t\t\t\t\t\telement.innerHTML =\n\t\t\t\t\t\t\t\t'<div class=\"mermaid-loading\">Rendering diagram...</div>';\n\n\t\t\t\t\t\t\t// 渲染图表\n\t\t\t\t\t\t\tconst { svg } = await window.mermaid.render(\n\t\t\t\t\t\t\t\t`mermaid-${Date.now()}-${index}-${attempts}`,\n\t\t\t\t\t\t\t\tcode,\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tconst parser = new DOMParser();\n\t\t\t\t\t\t\tconst doc = parser.parseFromString(svg, \"image/svg+xml\");\n\t\t\t\t\t\t\tconst svgElement = doc.documentElement;\n\n\t\t\t\t\t\t\telement.innerHTML = \"\";\n\t\t\t\t\t\t\telement.__zoomAttached = false;\n\t\t\t\t\t\t\telement.appendChild(svgElement);\n\n\t\t\t\t\t\t\t// 添加响应式支持\n\t\t\t\t\t\t\tconst insertedSvg = element.querySelector(\"svg\");\n\t\t\t\t\t\t\tif (insertedSvg) {\n\t\t\t\t\t\t\t\tinsertedSvg.setAttribute(\"width\", \"100%\");\n\t\t\t\t\t\t\t\tinsertedSvg.removeAttribute(\"height\");\n\t\t\t\t\t\t\t\tinsertedSvg.style.maxWidth = \"100%\";\n\t\t\t\t\t\t\t\tinsertedSvg.style.height = \"auto\";\n\t\t\t\t\t\t\t\t//Todo 需要根据实际情况\n\t\t\t\t\t\t\t\tinsertedSvg.style.minHeight = \"300px\";\n\n\t\t\t\t\t\t\t\t// 强制应用样式\n\t\t\t\t\t\t\t\tif (isDark) {\n\t\t\t\t\t\t\t\t\tsvgElement.style.filter = \"brightness(0.9) contrast(1.1)\";\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tsvgElement.style.filter = \"none\";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tattachZoomControls(element, insertedSvg);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// 渲染成功，跳出重试循环\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tattempts++;\n\t\t\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\t\t`Mermaid rendering attempt ${attempts} failed for element ${index}:`,\n\t\t\t\t\t\t\t\terror,\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tif (attempts >= maxAttempts) {\n\t\t\t\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t\t\t\t`Failed to render Mermaid diagram after ${maxAttempts} attempts:`,\n\t\t\t\t\t\t\t\t\terror,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\telement.innerHTML = `\n\t\t\t\t\t\t\t\t\t<div class=\"mermaid-error\">\n\t\t\t\t\t\t\t\t\t\t<p>Failed to render diagram after ${maxAttempts} attempts.</p>\n\t\t\t\t\t\t\t\t\t\t<button onclick=\"location.reload()\" style=\"margin-top: 8px; padding: 4px 8px; background: var(--primary); color: white; border: none; border-radius: 4px; cursor: pointer;\">\n\t\t\t\t\t\t\t\t\t\t\tRetry Page\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t`;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// 等待一段时间后重试\n\t\t\t\t\t\t\t\tawait new Promise((resolve) =>\n\t\t\t\t\t\t\t\t\tsetTimeout(resolve, 500 * attempts),\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t);\n\n\t\t\t// 等待所有渲染完成\n\t\t\tawait Promise.all(renderPromises);\n\t\t\tretryCount = 0; // 重置重试计数\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error in renderMermaidDiagrams:\", error);\n\n\t\t\t// 如果渲染失败，尝试重新渲染\n\t\t\tif (retryCount < MAX_RETRIES) {\n\t\t\t\tretryCount++;\n\t\t\t\tsetTimeout(() => renderMermaidDiagrams(), RETRY_DELAY * retryCount);\n\t\t\t}\n\t\t} finally {\n\t\t\tisRendering = false;\n\t\t}\n\t}\n\n\t// 初始化主题状态\n\tfunction initializeThemeState() {\n\t\tconst isDark = document.documentElement.classList.contains(\"dark\");\n\t\tcurrentTheme = isDark ? \"dark\" : \"default\";\n\t}\n\n\t// 加载 Mermaid 库\n\tasync function loadMermaid() {\n\t\tif (typeof window.mermaid !== \"undefined\") {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst script = document.createElement(\"script\");\n\t\t\tscript.src =\n\t\t\t\t\"https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js\";\n\n\t\t\tscript.onload = () => {\n\t\t\t\tconsole.log(\"Mermaid library loaded successfully\");\n\t\t\t\tresolve();\n\t\t\t};\n\n\t\t\tscript.onerror = (error) => {\n\t\t\t\tconsole.error(\"Failed to load Mermaid library:\", error);\n\t\t\t\t// 尝试备用 CDN\n\t\t\t\tconst fallbackScript = document.createElement(\"script\");\n\t\t\t\tfallbackScript.src = \"https://unpkg.com/mermaid@11/dist/mermaid.min.js\";\n\n\t\t\t\tfallbackScript.onload = () => {\n\t\t\t\t\tconsole.log(\"Mermaid library loaded from fallback CDN\");\n\t\t\t\t\tresolve();\n\t\t\t\t};\n\n\t\t\t\tfallbackScript.onerror = () => {\n\t\t\t\t\treject(\n\t\t\t\t\t\tnew Error(\n\t\t\t\t\t\t\t\"Failed to load Mermaid from both primary and fallback CDNs\",\n\t\t\t\t\t\t),\n\t\t\t\t\t);\n\t\t\t\t};\n\n\t\t\t\tdocument.head.appendChild(fallbackScript);\n\t\t\t};\n\n\t\t\tdocument.head.appendChild(script);\n\t\t});\n\t}\n\n\t// 主初始化函数\n\tasync function initialize() {\n\t\ttry {\n\t\t\t// 设置监听器\n\t\t\tsetupMutationObserver();\n\t\t\tsetupEventListeners();\n\n\t\t\t// 初始化主题状态\n\t\t\tinitializeThemeState();\n\n\t\t\t// 加载并初始化 Mermaid\n\t\t\tawait loadMermaid();\n\t\t\tawait initializeMermaid();\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Failed to initialize Mermaid system:\", error);\n\t\t}\n\t}\n\n\t// 启动初始化\n\tif (document.readyState === \"loading\") {\n\t\tdocument.addEventListener(\"DOMContentLoaded\", initialize);\n\t} else {\n\t\tinitialize();\n\t}\n})();\n</script></div></section><section><h2 id=\"conclusion\">Conclusion<a class=\"anchor\" href=\"#conclusion\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>Mermaid is a powerful tool for creating various types of diagrams in Markdown documents. This article demonstrated how to use flowcharts, sequence diagrams, Gantt charts, class diagrams, state diagrams, and pie charts. These diagrams can help you express complex concepts, processes, and data structures more clearly.</p><p>To use Mermaid, simply specify the mermaid language in a code block and describe the diagram using concise text syntax. Mermaid will automatically convert these descriptions into beautiful visual diagrams.</p><p>Try using Mermaid diagrams in your next technical blog post or project documentation - they will make your content more professional and easier to understand!</p></section></section>";

				const frontmatter = {"title":"Markdown Mermaid","published":"2023-10-01T00:00:00.000Z","pinned":false,"description":"A simple example of a Markdown blog post with Mermaid.","tags":["Markdown","Blogging","Mermaid"],"category":"Examples","draft":false,"minutes":3,"words":578,"excerpt":"This article demonstrates how to create various complex diagrams using Mermaid in Markdown documents, including flowcharts, sequence diagrams, Gantt charts, class diagrams, and state diagrams."};
				const file = "D:/lyf/blog/my_blog/src/content/posts/markdown-mermaid.md";
				const url = undefined;

				const Content = createComponent((result, _props, slots) => {
					const { layout, ...content } = frontmatter;
					content.file = file;
					content.url = url;

					return renderTemplate`${maybeRenderHead()}${unescapeHTML(html())}`;
				});

export { Content, Content as default, file, frontmatter, url };
